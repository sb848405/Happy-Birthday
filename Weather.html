<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>The Weather of You</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Inter:wght@300;400;600;800;900&family=Pacifico&display=swap" rel="stylesheet">
<style>
  :root{
    --royal-blue-dark: #001040; 
    --royal-blue-main: #002366; 
    --royal-gold: #D4AF37;
    --royal-gold-light: #F4C430;
    --royal-cream: #F5F5DC;
    --txt-primary: #fff;
    --txt-secondary: rgba(255,255,255,0.8);
  }
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{height:100%}
  body{
    font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    overflow:hidden;
    background: linear-gradient(120deg,#a18cd1,#fbc2eb);
    transition: background 900ms ease-in-out;
    color:var(--txt-primary);
    position:relative;
  }

  canvas#bg-canvas {
    position: absolute; inset: 0; z-index: 0; 
    pointer-events: none;
  }
  canvas#fx{
    position:absolute; inset:0; z-index:1; 
    pointer-events:none;
  }

  .stage{
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    text-align:center; padding:28px;
    perspective: 1200px;
    z-index: 10;
    transition: opacity 0.5s ease;
  }

  .card{
    width:min(720px,92vw);
    background: transparent; 
    box-shadow: none;
    animation: floatIn 700ms ease both;
    position: relative;
    cursor: default;
    z-index: 20;
    transform-style: preserve-3d;
    transition: opacity 0.5s ease, transform 0.5s ease, left 0.5s ease, width 0.5s ease;
  }
  
  .card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform-style: preserve-3d;
    cursor: pointer; 
  }
  
  .card.flipped .card-inner {
    transform: rotateY(180deg);
  }

  .card-front, .card-back {
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    border-radius:28px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    overflow: hidden;
  }

  .card-front {
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.3);
    padding:28px 22px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.5s ease;
  }

  .card-back {
    position: absolute;
    top: 0;
    left: 0;
    transform: rotateY(180deg);
    background: #fff;
  }
  
  .card-back img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 28px;
  }

  @keyframes floatIn{
    from{opacity:0; transform:translateY(18px)}
    to{opacity:1; transform:translateY(0)}
  }

  h1{
    font-family: 'Inter', sans-serif;
    font-size:clamp(26px,5.8vw,42px);
    line-height:1.2;
    margin-bottom:8px;
    letter-spacing:-0.5px;
    font-weight: 800;
    color: #fff;
    text-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }
  .sub{
    font-size:clamp(16px,3.8vw,19px);
    line-height:1.6;
    opacity:.95;
    font-weight: 500;
  }
  .quote{
    font-size:clamp(17px,4.2vw,22px);
    line-height:1.7;
    margin-top:12px;
    font-weight:600;
  }

  .controls{
    margin-top:18px;
    display:flex; align-items:center; justify-content:center; gap:10px;
  }
  .btn{
    appearance:none; border:0; cursor:pointer;
    padding:12px 26px; border-radius:22px;
    background: rgba(255,255,255,0.9);
    color: #333; 
    font-size:16px; font-weight:700;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition:transform .2s ease, box-shadow .25s ease;
    z-index: 30; 
  }
  .btn:hover{ transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); }
  .btn:active{ transform: translateY(0)}

  .meter{
    font-size:13px; opacity:.9; letter-spacing:.5px;
    margin-top:10px;
    font-weight: 600;
  }
  
  .hint-text {
    font-size: 11px;
    opacity: 0.8;
    margin-top: 8px;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-weight: 700;
  }

  .fade{
    position:absolute; inset:0; background: rgba(255,255,255,0.4);
    opacity:0; pointer-events:none;
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);
    transition: opacity .35s ease, backdrop-filter .45s ease;
    z-index: 5;
  }

  #celebration {
    position: absolute; inset: 0;
    display: none; 
    flex-direction: column;
    align-items: center; justify-content: center;
    pointer-events: none; 
    opacity: 0;
    transition: opacity 1.2s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 100; 
    padding: 20px;
    background: radial-gradient(circle at center, #1e40af 0%, #020617 100%);
  }
  #celebration.active {
    display: flex; 
    opacity: 1;
    pointer-events: auto;
  }

  .xmas-lights {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 40px;
    display: flex;
    justify-content: space-around;
    align-items: flex-start;
    padding: 0 10px;
    z-index: 120;
    pointer-events: none;
  }
  .xmas-lights .wire {
    position: absolute; top: -15px; left: -10%; width: 120%; height: 35px;
    border-bottom: 2px solid #222;
    border-radius: 50%;
    z-index: 1;
  }
  .bulb {
    width: 14px; height: 20px;
    border-radius: 50%;
    position: relative;
    z-index: 2;
    margin-top: 15px; 
    animation: glow 1.5s infinite alternate;
  }
  .bulb:before {
    content:''; position:absolute; top:-3px; left:2px; width:10px; height:4px; background:#444; border-radius:2px;
  }
  .bulb.red { background: #ef4444; box-shadow: 0 2px 15px #ef4444; animation-delay: 0s; }
  .bulb.green { background: #22c55e; box-shadow: 0 2px 15px #22c55e; animation-delay: 0.5s; }
  .bulb.gold { background: #eab308; box-shadow: 0 2px 15px #eab308; animation-delay: 1s; }
  .bulb.blue { background: #3b82f6; box-shadow: 0 2px 15px #3b82f6; animation-delay: 1.5s; }

  @keyframes glow {
    from { opacity: 0.7; transform: scale(0.9); filter: brightness(1); }
    to { opacity: 1; transform: scale(1.1); filter: brightness(1.5); box-shadow: 0 0 20px currentColor; }
  }

  .santa-hat {
    position: absolute;
    top: -28px;
    right: -10px;
    font-size: 42px;
    transform: rotate(20deg);
    filter: drop-shadow(0 4px 4px rgba(0,0,0,0.4));
    z-index: 30;
    animation: hatBounce 3s ease-in-out infinite;
  }
  @keyframes hatBounce {
      0%, 100% { transform: rotate(20deg) translateY(0); }
      50% { transform: rotate(25deg) translateY(-5px); }
  }

  .xmas-decor-icon {
      position: absolute;
      font-size: 28px;
      opacity: 0.9;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      animation: floatDecor 4s ease-in-out infinite;
  }
  .decor-tree { bottom: -25px; left: 10px; animation-delay: 0.2s; font-size: 32px; }
  .decor-gift { bottom: -20px; right: 10px; animation-delay: 1.2s; font-size: 28px; }
  .decor-snowflake { top: -20px; left: -10px; font-size: 24px; animation-delay: 2s; opacity: 0.6; }

  @keyframes floatDecor {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
  }

  .bday-content-box {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 50px 40px;
    border-radius: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 700px;
    width: 95%;
    animation: scaleIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    transform: scale(0.95);
    opacity: 0;
    position: relative; 
  }

  .bday-sub {
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    color: #93c5fd; 
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-bottom: 8px;
    font-weight: 700;
  }

  .bday-title {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-size: clamp(48px, 12vw, 96px);
    background: linear-gradient(to bottom right, #ffffff, #cbd5e1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    color: #fff;
    text-align: center;
    line-height: 0.95;
    margin-bottom: 30px;
    letter-spacing: -2px;
    filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.3));
  }
  
  .bday-separator {
      width: 60px;
      height: 4px;
      background: #3b82f6;
      border-radius: 2px;
      margin-bottom: 30px;
  }
  
  .bday-wish {
    font-family: 'Inter', sans-serif;
    font-weight: 300;
    font-size: clamp(16px, 4vw, 20px);
    color: rgba(255, 255, 255, 0.9);
    text-align: center;
    line-height: 1.7;
  }

  @keyframes scaleIn {
    0% { transform: scale(0.9); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }

  .badge{
    position:absolute; top:14px; left:50%; transform:translateX(-50%);
    font-size:12px; letter-spacing:.6px; opacity:.9; 
    background: rgba(255,255,255,0.25);
    color: #fff;
    font-weight: 700;
    padding:6px 12px; border-radius:999px; backdrop-filter: blur(6px);
    z-index:3;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    transition: opacity 0.3s;
  }
  
  #mainContent, #navToggleIcon, #navToggleX, #themeToggleIconSun, #themeToggleIconMoon {
      transition: all 0.3s ease-in-out;
  }
  #mainContent, #sidebar {
      -ms-overflow-style: none;
      scrollbar-width: none;
  }
  #mainContent::-webkit-scrollbar,
  #sidebar::-webkit-scrollbar {
      display: none;
  }
  
  .nav-panel {
      z-index: 290 !important;
      transition: all 0.3s ease-in-out;
  }
  
  #topNav, #bottomNav {
      z-index: 295 !important;
  }
  
  @media (min-width: 1024px) {
    .nav-panel {
        display: none !important;
    }
    
    .xmas-lights, .santa-hat, .xmas-decor-icon {
        display: none !important;
    }

    body.scenery-mode .stage {
        justify-content: flex-start;
        align-items: center; 
        padding-bottom: 0;
        padding-left: 80px;
    }

    body.scenery-mode .card {
        width: auto; 
        max-width: 50vw; 
        min-width: 600px;
        box-shadow: none;
        animation: none;
    }

    body.scenery-mode .card-front {
        background: transparent;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        border: none;
        box-shadow: none;
        align-items: flex-start;
        text-align: left;
        padding: 0;
        max-height: 80vh;
        overflow-y: auto;
    }
    
    body.scenery-mode .card-front::-webkit-scrollbar {
        width: 0px;
        background: transparent;
    }

    body.scenery-mode .card.flipped .card-inner {
        transform: none; 
    }

    body.scenery-mode .hint-text {
        display: none;
    }

    body.scenery-mode h1 {
        font-size: 56px;
        text-shadow: 0 4px 12px rgba(0,0,0,0.3);
        margin-bottom: 16px;
    }
    
    body.scenery-mode .sub {
        font-size: 20px;
        max-width: 750px; 
        width: 100%;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        line-height: 1.6;
    }
    
    body.scenery-mode .quote {
        font-size: 24px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        margin-top: 24px;
        max-width: 750px;
    }

    body.scenery-mode .controls {
        justify-content: flex-start;
        margin-top: 32px;
    }
    
    body.scenery-mode .meter {
        display: none;
    }

    #celebration {
        background: transparent !important;
        justify-content: flex-end;
        align-items: flex-start;
        padding-bottom: 80px;
        padding-left: 80px;
    }
    
    .bday-content-box {
        margin: 0;
        background: rgba(0, 0, 0, 0.2); 
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        max-width: 700px;
        align-items: flex-start;
        text-align: left;
        border: none;
        box-shadow: none;
    }
    
    .bday-title {
        text-align: left;
        font-size: 64px;
    }
    
    .bday-wish {
        text-align: left;
    }
    
    .bday-separator {
        align-self: flex-start;
        margin-left: 2px;
    }
  }
  
  .festive-text {
      font-family: 'Gochi Hand', cursive;
      letter-spacing: 1px;
  }
  button {
      user-select: none;
  }
  #mainContent {
      min-height: 100vh;
  }
  
  #navToggle {
      z-index: 300 !important;
      cursor: pointer;
  }
  #themeToggle {
      z-index: 300 !important;
      cursor: pointer;
  }
  #sidebar {
      z-index: 190 !important;
  }
  
  .hidden { display: none; }
</style>
</head>
<body>

<audio id="bgAudio" loop src="Yeh Raaten Yeh Mausam Sanam ft Simran Sehgal(KoshalWorld.Com).mp3" style="display:none;"></audio>

<button id="navToggle" class="fixed top-6 left-6 z-[300] p-2 bg-white/20 backdrop-blur-sm text-white rounded-full shadow-lg hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2">
  <svg id="navToggleIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="pointer-events: none;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-8 6h8"></path></svg>
  <svg id="navToggleX" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="pointer-events: none;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
</button>

<button id="themeToggle" class="fixed top-6 right-6 z-[300] p-2 bg-white/20 backdrop-blur-sm text-white rounded-full shadow-lg hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 hidden lg:block">
  <svg id="themeToggleIconSun" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
  </svg>
  <svg id="themeToggleIconMoon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
  </svg>
</button>

<nav id="topNav" class="nav-panel fixed top-0 left-0 right-0 h-16 bg-black/30 backdrop-blur-md text-white shadow-md flex items-center justify-center space-x-2  -translate-y-full">
  <a href="Msg.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Message</a>
  <a href="letter.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Letter</a>
  <a href="music.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Music</a>
</nav>

<nav id="bottomNav" class="nav-panel fixed bottom-0 left-0 right-0 h-16 bg-black/30 backdrop-blur-md text-white shadow-md flex items-center justify-center space-x-2 translate-y-full">
  <a href="skill.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Skill</a>
  <a href="paper_star.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Paper Star</a>
  <a href="cartoon.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Cartoon</a>
</nav>

<nav id="leftNav" class="nav-panel fixed left-0 top-0 bottom-0 w-24 bg-black/30 backdrop-blur-md text-white shadow-md flex flex-col items-center space-y-2 -translate-x-full overflow-y-auto py-20">
  <a href="index.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Home</a>
  <a href="cake.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Cake</a>
  <a href="21_door.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">21 Door</a>
  <a href="chat.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Heaven</a>
  <a href="diary.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Diary</a>
  <a href="anatomy.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Anatomy</a>
  <a href="box.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Box</a>
  <a href="special.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Special</a>
  <a href="color.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Color</a>
  <a href="you.html" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">You</a>
  <a href="teacher.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Teacher</a>
  <a href="universe.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Universe</a>
  <a href="The_River.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">River</a>
  <a href="Mountain.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Mountain</a>
</nav>

<nav id="rightNav" class="nav-panel fixed right-0 top-0 bottom-0 w-24 bg-black/30 backdrop-blur-md text-white shadow-md flex flex-col items-center space-y-2 translate-x-full overflow-y-auto py-20">
  <a href="periodik_table.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Periodic Table</a>
  <a href="concept.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Concept</a>
  <a href="calender.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Calendar</a>
  <a href="perspective.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Perspective</a>
  <a href="santa.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Santa</a>
  <a href="presence.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Presence</a>
  <a href="cloud.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Cloud</a>
  <a href="paint.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Paint</a>
  <a href="butterfly.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Butterfly</a>
  <a href="weather.html" class="nav-link p-2 rounded-md text-sm font-medium font-bold bg-white/20 transition-colors duration-200 festive-text">Weather</a>
  <a href="spotlight.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Spotlight</a>
  <a href="room.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Room</a>
  <a href="radio.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Radio</a>
  <a href="food.html" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-white/20 transition-colors duration-200 festive-text">Food</a>
</nav>

<aside id="sidebar" class="fixed left-0 top-0 bottom-0 w-80 sm:w-96 bg-black/40 backdrop-blur-xl border-r border-white/10 text-white shadow-2xl transform -translate-x-full transition-transform duration-500 cubic-bezier(0.4, 0, 0.2, 1) overflow-y-auto hidden lg:block">
  <div class="p-6 pt-24 grid grid-cols-2 gap-3">
    <a href="index.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Home</a>
    <a href="cake.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Cake</a>
    <a href="21_door.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">21 Door</a>
    <a href="chat.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Heaven</a>
    <a href="diary.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Diary</a>
    <a href="anatomy.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Anatomy</a>
    <a href="box.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Box</a>
    <a href="special.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Special</a>
    <a href="color.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Color</a>
    <a href="you.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">You</a>
    <a href="teacher.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Teacher</a>
    <a href="universe.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Universe</a>
    <a href="river.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">River</a>
    <a href="mountain.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Mountain</a>
    <a href="skill.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Skill</a>
    <a href="paper_star.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Paper Star</a>
    <a href="cartoon.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Cartoon</a>
    <a href="periodik_table.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Periodic Table</a>
    <a href="concept.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Concept</a>
    <a href="calender.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Calendar</a>
    <a href="perspective.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Perspective</a>
    <a href="santa.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Santa</a>
    <a href="presence.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Presence</a>
    <a href="cloud.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Cloud</a>
    <a href="Ink.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Paint</a>
    <a href="butterfly.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Butterfly</a>
    <a href="weather.html" class="nav-link bg-white/20 hover:bg-white/30 p-3 rounded-xl text-center text-sm font-bold transition-all hover:scale-105 active:scale-95 festive-text border border-white/20 shadow-lg ring-1 ring-white/30">Weather</a>
    <a href="spotlight.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Spotlight</a>
    <a href="room.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Room</a>
    <a href="radio.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Radio</a>
    <a href="Food.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Food</a>
    <a href="music.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Music</a>
    <a href="letter.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Letter</a>
    <a href="Msg.html" class="nav-link bg-white/5 hover:bg-white/20 p-3 rounded-xl text-center text-sm font-semibold transition-all hover:scale-105 active:scale-95 festive-text border border-white/5">Message</a>
  </div>
</aside>


<div id="mainContent" class="pt-28 lg:pt-0">
  <div class="badge" id="badge">INTRO</div>

  <canvas id="bg-canvas"></canvas>
  <canvas id="fx"></canvas>

  <div class="stage">
    <div class="card" id="card">
      <div class="card-inner" id="cardInner">
        
        <div class="card-front">
          <h1 id="title">The Weather of You</h1>
          <p class="sub" id="desc">
            Birthdays are special‚Ä¶ but you‚Äôre a whole different season of your own.<br/>
            Some people are sunshine. Some are winter calm. Some are monsoon comfort.<br/><br/>
            You‚Äôre not just one season ‚Äî you carry a little bit of every weather with you.<br/>
            I made a tiny journey to show that.
            <span class="hidden lg:inline"><br/><br/>It's rare to find a soul that shifts so gracefully between the energies of the world. Today, we celebrate not just the years, but the atmosphere you bring into our lives.</span>
          </p>
          <p class="quote" id="quote">Tap ‚ÄúNext‚Äù and let me take you through your seasons.</p>

          <div class="controls">
            <button class="btn" id="nextBtn">Next ‚Üí</button>
          </div>
          <div class="meter" id="meter">1 / 6</div>
          <div class="hint-text" id="hintText"></div>
        </div>

        <div class="card-back">
           <img id="cardImage" src="" alt="Season Mood" />
        </div>
        
      </div>
    </div>
  </div>

  <div id="celebration">
    
    <div class="xmas-lights lg:hidden">
      <div class="wire"></div>
      <div class="bulb red"></div>
      <div class="bulb green"></div>
      <div class="bulb gold"></div>
      <div class="bulb blue"></div>
      <div class="bulb red"></div>
      <div class="bulb green"></div>
      <div class="bulb gold"></div>
      <div class="bulb blue"></div>
    </div>

    <div class="bday-content-box relative">
      <div class="santa-hat lg:hidden">üéÖ</div>
      <div class="xmas-decor-icon decor-tree lg:hidden">üéÑ</div>
      <div class="xmas-decor-icon decor-gift lg:hidden">üéÅ</div>
      <div class="xmas-decor-icon decor-snowflake lg:hidden">‚ùÑÔ∏è</div>

      <div class="bday-sub">Here's to your beautiful seasons</div>
      <div class="bday-title">HAPPY<br>BIRTHDAY</div>
      <div class="bday-separator"></div>
      <p class="bday-wish">
        May you find joy in every shift of the wind and warmth in every ray of sun. 
        Just as the seasons change, may your happiness grow in new and beautiful ways. 
        Wishing you a year as wonderful as the weather you carry within you.
      </p>
    </div>
  </div>

  <div class="fade" id="fade"></div>
</div>

<script>
const slides = [
  {
    key:"intro",
    badge:"INTRO",
    bg:["#ff9a9e","#fecfef"], 
    day: {
        title:"The Weather of You",
        desc:`Birthdays are special‚Ä¶ but you‚Äôre a whole different season of your own.<br/>
              <span class="hidden lg:inline"><br/><br/>You have a way of standing in the world without demanding space, yet somehow becoming the reason it feels fuller. You carry more than people ever notice, and still you move with care, choosing kindness when it would be easier not to. This page exists because your life is not ordinary weather. It is the kind that teaches patience, resilience, and quiet hope. Today is your birthday, and it matters because the days learned something by having you in them, how to endure, how to soften, how to keep going.</span>`,
        quote:"Tap ‚ÄúNext‚Äù and let me take you through your seasons."
    },
    night: {
        title:"The Midnight of You",
        desc:`Even in the quietest hours, you shine in your own way.
              The night brings out the stars, just like quiet moments bring out your depth.
              Let's see the peaceful side of your seasons.
              <span class="hidden lg:inline"><br/><br/>The darkness isn't an absence of light here; it's a canvas for your constellations. Every quiet thought you have adds another star to this sky.</span>`,
        quote:"The night is just a canvas for your light."
    },
    particles:"soft",
    img: ""
  },
  {
    key:"summer",
    badge:"SUMMER",
    bg:["#ffe259","#ffa751"], 
    day: {
        title:"Summer ‚Ä¢ Brightness",
        desc:`You brighten rooms like long summer days warm, lively, and full of possibility.
              <span class="hidden lg:inline"><br/>Your beauty in this season shows in the way you hold eye contact, in the calm of your expressions when things are demanding more than they should. You do what needs to be done even when the days are long and patience runs thin. Your struggles exist in the weight you carry and the way you keep moving without complaint. The hurdles you face to adjust your stride. Your kindness appears in small, deliberate choices, listening fully, showing up when it isn‚Äôt convenient. And your personality is steady and self-aware, grounded without being rigid, confident without needing permission.</span>`,
        quote:"You have that sunlight‚Ä¶ the kind that makes people smile without realising."
    },
    night: {
        title:"Summer Nights ‚Ä¢ Afterglow",
        desc:`The heat of the day settles into a warm, comfortable embrace. Like your lasting kindness.
              <span class="hidden lg:inline">This is your summer after the sun steps back. The hours where the day‚Äôs weight finally loosens its grip. You carry stress, emotions, and unspoken thoughts through the heat of the day, then set them down quietly when night arrives. There is tenderness in how you hold yourself here, tired but present, choosing connection over collapse. You share laughter even when your mind is full, creating light moments. With family, you become softer, attentive, trying in small, sincere ways to make the evening feel easier, happierr. This is your beauty at rest. Not performing, not proving. Just giving what you can, honestly, after everything else is done.</span>`,
        quote:"Even after the sun sets, your warmth lingers."
    },
    particles:"shimmer",
    img: "Summer.png"
  },
  {
    key:"monsoon",
    badge:"MONSOON",
    bg:["#4e65ff","#92efff"],
    day: {
        title:"Monsoon ‚Ä¢ Comfort",
        desc:`You arrive like rain after a long summer sudden, soft, impossible to ignore.
              <span class="hidden lg:inline"><br/>This is the season that understands you best. Your beauty here is quiet and honest, revealed in reflection rather than display. Your strength shows when emotions run high and uncertainty settles in. You feel deeply, yet you don‚Äôt let the overflow wash you away. The struggles you face arrive suddenly, like heavy rain, disrupting plans and testing balance. Still, you learn how to stand in it, how to keep moving even when the ground feels unstable. Your kindness appears in how you make space for others‚Äô storms, offering patience instead of judgment. And your personality carries depth, thoughtful, introspective, aware that growth often begins when the sky refuses to stay clear.</span>`,
        quote:"Some silences are loud. Yours is rain it calms everything."
    },
    night: {
        title:"Stormy Nights ‚Ä¢ Shelter",
        desc:`The world outside may be wild, but inside, with you, it's safe and sound.
              <span class="hidden lg:inline">Rain follows you into the night persistently. The day leaves behind unfinished thoughts, emotions that stay without permission. You don‚Äôt push them away. You carry them carefully. At home, you shift roles without effort. You become attentive, present, quietly invested in the mood around you. You notice what others need before they say it. You offer ease, small smiles, shared moments, not because you feel light, but because you choose to create light. The rain keeps falling, the world stays restless, yet inside, you work gently to keep things steady, warmer, calmer. This is care in its most honest form.</span>`,
        quote:"The rain sings a lullaby just for you."
    },
    particles:"rain",
    img: "Rain.png"
  },
  {
    key:"autumn",
    badge:"AUTUMN",
    bg:["#ff9a3c","#ff6a00"],
    day: {
        title:"Autumn ‚Ä¢ Warmth",
        desc:`You make the world feel cozy, even change feels gentle around you.
              <span class="hidden lg:inline"><br/>This is where your depth lives. Your beauty here is layered, shaped by everything you‚Äôve had to release. It shows in restraint, in knowing when silence speaks better than words. Your strength is emotional accuracy. You recognize what no longer serves you and still let it go gently. The struggles in this season are slow and internal, not dramatic but heavy, asking for patience and honesty. The hurdles are memories, expectations, unfinished chapters, and you face them without pretending they don‚Äôt exist. Your kindness becomes selective, intentional, offered with care rather than habit. And your personality feels grounded and thoughtful, someone who understands that change doesn‚Äôt mean loss, it means making space for what‚Äôs real.</span>`,
        quote:"If warmth ever chose a season, it would choose you."
    },
    night: {
        title:"Crisp Evening ‚Ä¢ Firelight",
        desc:`A cool breeze outside, a warm fire inside. That balance is your spirit.
              <span class="hidden lg:inline">Your journey doesn‚Äôt look crowded, even though it is full. You move from water to land, from stillness to motion, from discipline to expression, with a simplicity that feels effortless from the outside. Boating teaches you balance, botany teaches you patience, hills teach you how to breathe through effort. Karate and kickboxing sharpen your focus, yoga brings you back to center, drawing gives your thoughts a place to rest. None of these compete with each other in you. You make space for all of them by staying honest about what matters and letting go of what doesn‚Äôt. Autumn suits you because it reflects who you are becoming. Someone who grows in many directions, quietly, steadily, without needing to explain how you manage it all.
</span>`,
        quote:"Golden leaves glowing under the moonlight."
    },
    particles:"leaves",
    img: "Auttom.png"
  },
  {
    key:"prewinter",
    badge:"PRE WINTER",
    bg:["#cfd9df","#e2ebf0"],
    day: {
        title:"Pre Winter ‚Ä¢ Magic",
        desc:`That dreamy hush before the cold that‚Äôs the kind of quiet you carry.
              <span class="hidden lg:inline"><br/>This is the pause before everything slows. You become more inward here, more deliberate. There is a quiet elegance in how you move through uncertainty without needing reassurance. The things you‚Äôve faced don‚Äôt sit heavily on you anymore, they‚Äôve sharpened your awareness. You anticipate challenges without fear and meet them with composure. Your care for others is steady and sincere, shown through consistency rather than words. Your personality feels calm, observant, and self-possessed, someone who knows the cold is coming and has already learned how to stay steady within it.</span>`,
        quote:"You feel like the soft pause before winter begins."
    },
    night: {
        title:"Frosty Night ‚Ä¢ Starlight",
        desc:`The air is crisp and the stars look sharper. Clarity and beauty combined.
              <span class="hidden lg:inline"><br/>Night finally settles in after a long, demanding day. Sleep pulls at you gently, the kind you love and crave, yet your mind is still aware of what needs care. You move through the house softly, helping where you can, making sure things are in place before rest claims you. Even after teaching, guiding, explaining, giving your patience away all day, You remain present. There is something deeply human in how you balance tiredness with responsibility, choosing thoughtfulness over comfort. Pre winter nights suit you. Quiet, heavy with fatigue, yet filled with small acts that show how much you give, even when all you want is to rest</span>`,
        quote:"The stars shine brightest in your clear sky."
    },
    particles:"mist",
    img: "Pre Winter.png"
  },
  {
    key:"winter",
    badge:"WINTER",
    bg:["#83a4d4","#b6fbff"],
    day: {
        title:"Winter ‚Ä¢ Calm",
        desc:`Clear skies, slow breath, gentle peace your presence is a winter morning.
              <span class="hidden lg:inline"><br/>This is the season where your growth becomes visible. Your beauty feels settled and assured, shaped by experience rather than uncertainty. It shows in your calm expressions, in the ease with which you carry yourself. Your strength comes from understanding, knowing what to keep, what to release, and doing both without bitterness. The struggles you‚Äôve faced have given you clarity, not weight. The hurdles refined your perspective instead of dimming it. Your kindness here is thoughtful and genuine, offered with intention and care. And your personality feels balanced and wise, someone who moves forward with confidence, grounded in who she has become.</span>`,
        quote:"Cold outside, warm inside that‚Äôs your kind of calm. Happy 21st. ‚ú®"
    },
    night: {
        title:"Silent Night ‚Ä¢ Peace",
        desc:`A blanket of snow quiets the world. A deep, restorative peace.
              <span class="hidden lg:inline">Winter is where everything you carry comes together. Dreams, office work, teaching, learning something new, all moving at once, all held carefully. You handle full days and fuller expectations with a steady smile, finding joy in small moments. Time with family and friends becomes lighter around you because you choose it to be. You listen, you laugh, you show up. What no one sees is the quiet complexity beneath that ease. The thoughts you keep to yourself, the feelings you manage alone. And yet, you never let that weight spill outward. Winter in you is composure, grace, and the rare ability to move through life with warmth in your expression, even when the cold runs deep inside.</span>`,
        quote:"The world goes quiet, just to listen to you."
    },
    particles:"snow",
    img: "Winter.png"
  }
];

let index = 0;
let current = slides[index];
let isNightMode = false;

let isTransitioning = false;
let isCelebration = false;
let birds = []; 
let waterRipples = [];

const badge = document.getElementById('badge');
const card  = document.getElementById('card');
const stage = document.querySelector('.stage'); 
const cardInner = document.getElementById('cardInner');
const title = document.getElementById('title');
const desc  = document.getElementById('desc');
const quote = document.getElementById('quote');
const nextBtn = document.getElementById('nextBtn');
const meter = document.getElementById('meter');
const fadeLayer = document.getElementById('fade');
const cardImage = document.getElementById('cardImage');
const hintText = document.getElementById('hintText');
const celebration = document.getElementById('celebration');

const canvas = document.getElementById('fx');
const ctx = canvas.getContext('2d');
const bgCanvas = document.getElementById('bg-canvas');
const bgCtx = bgCanvas.getContext('2d');

let particles = [];
let raf;

function updateDisplayMode() {
    if (!current) return;
    let isDesktop = window.innerWidth >= 1024;
    
    if (isDesktop) {
        document.body.classList.add('scenery-mode');
        if (card) card.classList.remove('flipped');
    } else {
        document.body.classList.remove('scenery-mode');
    }
}

function checkAudio() {
    const audio = document.getElementById('bgAudio');
    if (!audio) return;
    
    const isDesktop = window.innerWidth >= 1024;
    
    if (isNightMode && isDesktop) {
        if (audio.paused) {
            audio.volume = 0.5; 
            audio.play().catch(e => console.log("Audio autoplay prevented:", e));
        }
    } else {
        if (!audio.paused) {
            audio.pause();
        }
    }
}

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  bgCanvas.width = window.innerWidth;
  bgCanvas.height = window.innerHeight;
  
  updateDisplayMode();
  checkAudio(); 
}
window.addEventListener('resize', resize);
resize();

class Bird {
    constructor(x, y, speed) {
        this.x = x;
        this.y = y;
        this.speed = speed;
        this.wingSpan = 10 + Math.random()*5;
        this.wingAngle = 0;
    }
    update() {
        this.x += this.speed;
        this.y += Math.sin(this.x * 0.02) * 0.5;
        this.wingAngle += 0.2;
        if(this.x > bgCanvas.width + 50) this.x = -50;
    }
    draw(ctx) {
        ctx.beginPath();
        ctx.strokeStyle = isNightMode ? "#555" : "black";
        ctx.lineWidth = 1.5;
        let flap = Math.sin(this.wingAngle) * 3;
        ctx.moveTo(this.x, this.y);
        ctx.quadraticCurveTo(this.x - 5, this.y - 5 + flap, this.x - this.wingSpan, this.y - 5 + flap);
        ctx.moveTo(this.x, this.y);
        ctx.quadraticCurveTo(this.x + 5, this.y - 5 + flap, this.x + this.wingSpan, this.y - 5 + flap);
        ctx.stroke();
    }
}

class Ripple {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.r = 0;
        this.alpha = 1;
        this.speed = 0.5 + Math.random() * 0.5;
    }
    update() {
        this.r += this.speed;
        this.alpha -= 0.015;
    }
    draw(ctx) {
        if(this.alpha <= 0) return;
        ctx.save();
        ctx.globalAlpha = this.alpha;
        ctx.strokeStyle = "rgba(255, 255, 255, 0.6)";
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.r, this.r * 0.4, 0, 0, Math.PI*2); 
        ctx.stroke();
        ctx.restore();
    }
}

function initBirds() {
    birds = [];
    for(let i=0; i<6; i++){
        birds.push(new Bird(Math.random()*bgCanvas.width, 100 + Math.random()*150, 1 + Math.random()));
    }
}

let treeSeed = 1;
function seededRandom() {
    const x = Math.sin(treeSeed++) * 10000;
    return x - Math.floor(x);
}

function applyNightTheme(t) {
   if(current.key === 'winter') {
       t.sky = ["#000000", "#0f2027", "#2c5364"]; 
   } else if (current.key === 'intro') {
       t.sky = ["#0f2027", "#203a43", "#2c5364"]; 
   } else {
       t.sky = ["#0B1026", "#2B32B2", "#414345"]; 
   }

   t.ground = adjustColorBrightness(t.ground, -50);
   if (t.grassColor) t.grassColor = adjustColorBrightness(t.grassColor, -50);
   t.treeTrunk = adjustColorBrightness(t.treeTrunk, -40);
   if (t.leafColor) t.leafColor = adjustColorBrightness(t.leafColor, -40);

   t.sunVisible = false;

   t.water = [adjustColorBrightness(t.water[0], -50), adjustColorBrightness(t.water[1], -40)];
   t.sunGlow = ["rgba(255, 255, 255, 0.1)", "rgba(255, 255, 255, 0)"];
}

function drawMoon(ctx, w, h) {
   let mx = w * 0.8;
   let my = h * 0.15;
   let size = Math.min(w,h) * 0.07;

   let g = ctx.createRadialGradient(mx, my, size, mx, my, size*4);
   g.addColorStop(0, "rgba(255, 255, 255, 0.4)");
   g.addColorStop(1, "rgba(255, 255, 255, 0)");
   ctx.fillStyle = g;
   ctx.beginPath(); ctx.arc(mx, my, size*4, 0, Math.PI*2); ctx.fill();

   ctx.fillStyle = "#fdfbf7";
   ctx.shadowColor = "#ffffff";
   ctx.shadowBlur = 20;
   ctx.beginPath(); ctx.arc(mx, my, size, 0, Math.PI*2); ctx.fill();
   ctx.shadowBlur = 0;

   ctx.globalAlpha = 0.1;
   ctx.fillStyle = "#888";
   ctx.beginPath(); ctx.arc(mx - size*0.3, my - size*0.2, size*0.2, 0, Math.PI*2); ctx.fill();
   ctx.beginPath(); ctx.arc(mx + size*0.4, my + size*0.3, size*0.15, 0, Math.PI*2); ctx.fill();
   ctx.beginPath(); ctx.arc(mx + size*0.1, my + size*0.5, size*0.1, 0, Math.PI*2); ctx.fill();
   ctx.globalAlpha = 1.0;
}

function drawStars(ctx, w, h) {
    ctx.fillStyle = "#fff";
    let oldSeed = treeSeed;
    treeSeed = 999;
    
    for(let i=0; i<100; i++) {
        let x = seededRandom() * w;
        let y = seededRandom() * h * 0.6; 
        let s = seededRandom() * 2 + 0.5;
        let alpha = 0.3 + seededRandom() * 0.7;
        
        ctx.globalAlpha = alpha;
        ctx.beginPath(); ctx.arc(x, y, s, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1.0;
    treeSeed = oldSeed;
}

function drawUniversalLandscape(ctx, w, h, time) {
    treeSeed = 123;
    let theme = getTheme(current.key);
    
    if (isNightMode) {
        applyNightTheme(theme);
    }

    let grd = ctx.createLinearGradient(0, 0, 0, h*0.6);
    grd.addColorStop(0, theme.sky[0]);  
    grd.addColorStop(0.5, theme.sky[1]); 
    grd.addColorStop(1, theme.sky[2]);   
    ctx.fillStyle = grd;
    ctx.fillRect(0,0,w,h);

    if (isNightMode) {
        drawStars(ctx, w, h);
        drawMoon(ctx, w, h);
    } else if (theme.sunVisible) {
        let sunX = w * 0.8;
        let sunY = h * 0.15;
        let sunSize = Math.min(w,h) * 0.08;
        
        let sunGlow = ctx.createRadialGradient(sunX, sunY, sunSize*0.5, sunX, sunY, sunSize*2);
        sunGlow.addColorStop(0, theme.sunGlow[0]);
        sunGlow.addColorStop(0.5, theme.sunGlow[1]);
        sunGlow.addColorStop(1, "rgba(255, 255, 255, 0)");
        ctx.fillStyle = sunGlow;
        ctx.beginPath();
        ctx.arc(sunX, sunY, sunSize*3, 0, Math.PI*2);
        ctx.fill();

        ctx.fillStyle = theme.sunColor;
        ctx.shadowColor = theme.sunShadow;
        ctx.shadowBlur = 40;
        ctx.beginPath();
        ctx.arc(sunX, sunY, sunSize, 0, Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    let groundY = h * 0.55;
    ctx.fillStyle = theme.ground; 
    ctx.beginPath();
    ctx.moveTo(0, groundY);
    ctx.bezierCurveTo(w*0.3, groundY - 20, w*0.7, groundY + 20, w, groundY);
    ctx.lineTo(w, h);
    ctx.lineTo(0, h);
    ctx.fill();

    drawRoad(ctx, w, h, groundY);

    if (theme.grassColor) {
        drawGrass(ctx, w, h, groundY, theme.grassColor);
    }

    let houseBaseScale = Math.min(w,h) * 0.0016;
    
    drawHouse(ctx, w * 0.70, groundY, houseBaseScale * 0.6, "#aed6f1", "#34495e", theme.isSnowy, isNightMode);
    drawHouse(ctx, w * 0.85, groundY + 10, houseBaseScale, "#f5f5dc", "#8b4513", theme.isSnowy, isNightMode);
    drawHouse(ctx, w * 0.95, groundY - 10, houseBaseScale * 0.5, "#fadbd8", "#c0392b", theme.isSnowy, isNightMode);

    let treeSway = 0;
    if (current.key === 'autumn') {
        treeSway = (Math.sin(time * 0.002) * 0.02) + (Math.cos(time * 0.003) * 0.01);
    } else if (current.key === 'summer' || current.key === 'prewinter' || current.key === 'winter') {
        treeSway = Math.sin(time * 0.001) * 0.015;
    }

    drawTree(ctx, w * 0.05, groundY - 5, h*0.10, 3, 4, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway); 
    drawTree(ctx, w * 0.15, groundY + 10, h*0.15, 4, 6, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway);
    drawTree(ctx, w * 0.25, groundY + 30, h*0.12, 3, 5, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway);
    drawTree(ctx, w * 0.40, groundY + 5, h*0.14, 4, 5, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway); 

    drawPond(ctx, w*0.65, h*0.75, w*0.22, theme.waterLevel, theme.waterType, theme.water, theme.ground, theme.isSnowy || (theme.sunVisible && !isNightMode));

    drawTree(ctx, w * 0.1, h + 20, h*0.5, 9, 30, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway * 0.5); 
    drawTree(ctx, w * 0.9, h + 50, h*0.6, 9, 35, theme.treeTrunk, theme.leafColor, theme.isSnowy, treeSway * 0.5); 
    
    if (theme.sunVisible && !isNightMode) {
        birds.forEach(b => {
            b.update();
            b.draw(ctx);
        });
    }
}

function drawPond(ctx, x, y, radius, waterLevel, waterType, waterColors, groundColor, hasReflection) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(1, 0.4); 

    let bankGrad = ctx.createRadialGradient(0, 0, radius * 0.8, 0, 0, radius * 1.1);
    bankGrad.addColorStop(0, groundColor);
    bankGrad.addColorStop(1, adjustColorBrightness(groundColor, -30)); 

    ctx.fillStyle = bankGrad;
    ctx.beginPath();
    ctx.arc(0, 0, radius * 1.05, 0, Math.PI * 2);
    ctx.fill();

    ctx.globalAlpha = 0.2;
    for (let i = 0; i < 50; i++) {
        let angle = seededRandom() * Math.PI * 2;
        let dist = radius * (0.9 + seededRandom() * 0.2);
        let s = 2 + seededRandom() * 3;
        ctx.fillStyle = seededRandom() > 0.5 ? "#000" : "#fff";
        ctx.beginPath();
        ctx.arc(Math.cos(angle) * dist, Math.sin(angle) * dist, s, 0, Math.PI * 2);
        ctx.fill();
    }
    ctx.globalAlpha = 1.0;

    let waterRadius = radius * waterLevel * 0.95;
    let waterGrad;

    if (waterType === 'ice') {
        waterGrad = ctx.createRadialGradient(0, 0, 5, 0, 0, waterRadius);
        waterGrad.addColorStop(0, "#f0f8ff"); 
        waterGrad.addColorStop(0.8, "#d4e6f1"); 
        waterGrad.addColorStop(1, "#90caf9"); 

        ctx.fillStyle = waterGrad;
        ctx.beginPath();
        ctx.arc(0, 5, waterRadius, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = "rgba(255, 255, 255, 0.6)";
        ctx.lineWidth = 1;
        for (let i = 0; i < 8; i++) {
            ctx.beginPath();
            let startAngle = seededRandom() * Math.PI * 2;
            ctx.moveTo(Math.cos(startAngle) * waterRadius * 0.2, Math.sin(startAngle) * waterRadius * 0.2 + 5);
            let endAngle = startAngle + (seededRandom() - 0.5) * 1.5;
            ctx.lineTo(Math.cos(endAngle) * waterRadius, Math.sin(endAngle) * waterRadius + 5);
            ctx.stroke();
        }

    } else if (waterType === 'dry') {
        waterGrad = ctx.createRadialGradient(0, 0, 5, 0, 0, waterRadius);
        waterGrad.addColorStop(0, adjustColorBrightness(groundColor, 20));
        waterGrad.addColorStop(1, adjustColorBrightness(groundColor, -10));

        ctx.fillStyle = waterGrad;
        ctx.beginPath();
        ctx.arc(0, 5, waterRadius, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = "rgba(0, 0, 0, 0.3)";
        ctx.lineWidth = 1.5;
        for (let i = 0; i < 15; i++) {
            let angle = seededRandom() * Math.PI * 2;
            let dist = seededRandom() * waterRadius * 0.8;
            let x1 = Math.cos(angle) * dist;
            let y1 = Math.sin(angle) * dist + 5;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            for(let j=0; j<3; j++) {
                let a2 = angle + (seededRandom()-0.5) * 1.5;
                let d2 = dist + 10 + seededRandom()*20;
                 ctx.lineTo(Math.cos(a2)*d2, Math.sin(a2)*d2 + 5);
            }
            ctx.stroke();
        }

        ctx.fillStyle = "#89cff0";
        ctx.beginPath();
        ctx.ellipse(0, 10, waterRadius * 0.3, waterRadius * 0.15, seededRandom()*0.5, 0, Math.PI * 2);
        ctx.fill();

    } else {
        waterGrad = ctx.createLinearGradient(0, -waterRadius, 0, waterRadius);
        waterGrad.addColorStop(0, waterColors[0]);
        waterGrad.addColorStop(1, waterColors[1]);

        ctx.fillStyle = waterGrad;
        ctx.beginPath();
        ctx.arc(0, 5, waterRadius, 0, Math.PI * 2);
        ctx.fill();

        if (waterType === 'liquid') {
            ctx.save();
            ctx.beginPath();
            ctx.arc(0, 5, waterRadius, 0, Math.PI * 2);
            ctx.clip();

            if (current.key === 'monsoon' && Math.random() < 0.3) {
                let rx = (Math.random() - 0.5) * waterRadius * 1.5;
                let ry = (Math.random() - 0.5) * waterRadius * 1.5 + 5;
                if (Math.sqrt(rx*rx + ry*ry) < waterRadius) {
                    waterRipples.push(new Ripple(rx, ry));
                }
            } else if (Math.random() < 0.05) { 
                 let rx = (Math.random() - 0.5) * waterRadius * 1.5;
                 let ry = (Math.random() - 0.5) * waterRadius * 1.5 + 5;
                 if (Math.sqrt(rx*rx + ry*ry) < waterRadius) {
                    waterRipples.push(new Ripple(rx, ry));
                 }
            }

            for (let i = waterRipples.length - 1; i >= 0; i--) {
                let rip = waterRipples[i];
                rip.update();
                rip.draw(ctx);
                if (rip.alpha <= 0) {
                    waterRipples.splice(i, 1);
                }
            }
            ctx.restore();
        }

        ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
        ctx.lineWidth = 2;
        for (let i = 0; i < 5; i++) {
            let r = waterRadius * (0.3 + i * 0.15);
            let start = Math.PI + seededRandom() * 0.5;
            let end = 2 * Math.PI - seededRandom() * 0.5;
            ctx.beginPath();
            ctx.arc(0, 5, r, start, end);
            ctx.stroke();
        }
    }

    if (hasReflection && waterType !== 'dry') {
        ctx.save();
        ctx.clip(); 

        ctx.fillStyle = "rgba(255, 255, 255, 0.2)";
        ctx.beginPath();
        ctx.moveTo(-25, -5);
        ctx.bezierCurveTo(-15, -15, 0, 0, 15, -10);
        ctx.bezierCurveTo(25, -5, 15, 5, 5, 15);
        ctx.bezierCurveTo(-10, 10, -20, 5, -25, -5);
        ctx.fill();
        
        ctx.restore();
    }

    ctx.restore();
}

function adjustColorBrightness(hex, percent) {
    var num = parseInt(hex.replace("#",""),16),
    amt = Math.round(2.55 * percent),
    R = (num >> 16) + amt,
    B = (num >> 8 & 0x00ff) + amt,
    G = (num & 0x0000ff) + amt;
    return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (B<255?B<1?0:B:255)*0x100 + (G<255?G<1?0:G:255)).toString(16).slice(1);
}


function getTheme(key) {
    let t = {
        sky: ["#4fa8f5", "#8fd3f4", "#fdfbf0"],
        ground: "#e0c38c",
        grassColor: null, 
        sunVisible: true,
        sunColor: "#fff",
        sunShadow: "#ffaa00",
        sunGlow: ["rgba(255, 255, 230, 0.9)", "rgba(255, 220, 100, 0.3)"],
        treeTrunk: "#8a704c",
        leafColor: null, 
        isSnowy: false,
        water: ["#89cff0", "#3a7bd5"],
        waterLevel: 0.3, 
        waterType: 'dry' 
    };

    if (key === 'intro') {
        t.sky = ["#ff9a9e", "#fecfef", "#fdfbfb"]; 
        t.ground = "#f5e6ca"; 
        t.grassColor = "#a3d9a5"; 
        t.sunVisible = true;
        t.sunColor = "#ffffff";
        t.sunShadow = "#ffd1dc";
        t.sunGlow = ["rgba(255, 220, 220, 0.8)", "rgba(255, 240, 245, 0.4)"];
        t.treeTrunk = "#a1887f";
        t.leafColor = "#f48fb1"; 
        t.water = ["#b3e5fc", "#e1f5fe"];
        t.waterLevel = 0.6;
        t.waterType = 'liquid';
    } else if (key === 'monsoon') {
        t.sky = ["#2c3e50", "#4ca1af", "#bdc3c7"];
        t.ground = "#4e342e"; 
        t.grassColor = "#1b5e20"; 
        t.sunVisible = false;
        t.treeTrunk = "#3e2723";
        t.leafColor = "#1b5e20"; 
        t.water = ["#1a237e", "#283593"];
        t.waterLevel = 1.1;
        t.waterType = 'liquid';
    } else if (key === 'autumn') {
        t.sky = ["#f12711", "#f5af19", "#fff3e0"];
        t.ground = "#66bb6a"; 
        t.grassColor = "#4caf50"; 
        t.sunColor = "#ffeb3b";
        t.sunShadow = "#ff5722";
        t.sunGlow = ["rgba(255, 200, 100, 0.8)", "rgba(255, 100, 50, 0.3)"];
        t.treeTrunk = "#5d4037";
        t.leafColor = "#d35400";
        t.water = ["#e67e22", "#d35400"];
        t.waterLevel = 0.9;
        t.waterType = 'liquid';
    } else if (key === 'prewinter') {
        t.sky = ["#757f9a", "#d7dde8", "#f5f7fa"];
        t.ground = "#43a047"; 
        t.grassColor = "#2e7d32"; 
        t.sunVisible = true;
        t.sunColor = "#ecf0f1";
        t.sunShadow = "#bdc3c7";
        t.sunGlow = ["rgba(255, 255, 255, 0.5)", "rgba(200, 200, 200, 0.1)"];
        t.treeTrunk = "#594a4e";
        t.leafColor = null; 
        t.water = ["#7f8c8d", "#bdc3c7"];
        t.waterLevel = 0.85;
        t.waterType = 'liquid';
    } else if (key === 'winter') {
        t.sky = ["#2980b9", "#6dd5fa", "#ffffff"];
        t.ground = "#e1f5fe"; 
        t.grassColor = "#2e7d32"; 
        t.sunVisible = true;
        t.sunColor = "#ffffff";
        t.sunShadow = "#ffffff";
        t.sunGlow = ["rgba(255, 255, 255, 0.8)", "rgba(200, 240, 255, 0.4)"];
        t.treeTrunk = "#2c3e50";
        t.leafColor = null; 
        t.isSnowy = true;
        t.water = ["#a9cce3", "#d6eaf8"];
        t.waterLevel = 0.9;
        t.waterType = 'ice';
    }

    return t;
}

function drawRoad(ctx, w, h, groundY) {
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(w * 0.4, h); 
    ctx.bezierCurveTo(w * 0.45, h * 0.8, w * 0.55, h * 0.7, w * 0.6, groundY);
    ctx.bezierCurveTo(w * 0.65, h * 0.7, w * 0.7, h * 0.8, w * 0.8, h);
    ctx.fillStyle = isNightMode ? "#6d5c58" : "#d7ccc8"; 
    ctx.fill();
    ctx.restore();
}

function drawGrass(ctx, w, h, groundY, color) {
    ctx.save();
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    ctx.lineWidth = 1.5;
    
    for(let i=0; i<400; i++) {
        let x = seededRandom() * w;
        let y = groundY + seededRandom() * (h - groundY);
        
        let roadCenter = w * 0.6; 
        let roadWidth = (y - groundY)/(h - groundY) * (w*0.4) + 20; 
        if (Math.abs(x - roadCenter) < roadWidth * 0.4) continue;

        let scale = (y - groundY) / (h - groundY); 
        let size = 5 + scale * 10;
        
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.quadraticCurveTo(x - 3, y - size*0.5, x - 5, y - size);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.quadraticCurveTo(x + 3, y - size*0.5, x + 5, y - size);
        ctx.stroke();
    }
    ctx.restore();
}

function drawHouse(ctx, x, y, scale, wallColor, roofColor, isSnowy, isNight) {
    ctx.save();
    ctx.translate(x, y);
    ctx.scale(scale, scale);
    
    ctx.fillStyle = "rgba(0,0,0,0.1)";
    ctx.beginPath();
    ctx.ellipse(0, 10, 80, 20, 0, 0, Math.PI*2);
    ctx.fill();

    if (isNight) {
        wallColor = adjustColorBrightness(wallColor, -40);
        roofColor = adjustColorBrightness(roofColor, -40);
    }

    ctx.fillStyle = wallColor; 
    ctx.fillRect(-60, -80, 120, 80);
    
    ctx.fillStyle = roofColor; 
    ctx.beginPath();
    ctx.moveTo(-70, -80);
    ctx.lineTo(0, -140);
    ctx.lineTo(70, -80);
    ctx.fill();

    if (isSnowy) {
        ctx.fillStyle = isNight ? "#ccc" : "#fff";
        ctx.beginPath();
        ctx.moveTo(-60, -80);
        ctx.lineTo(0, -130);
        ctx.lineTo(60, -80);
        ctx.fill();
    }

    ctx.fillStyle = "#5d4037";
    ctx.fillRect(-20, -40, 40, 40);
    
    if (isNight) {
        ctx.fillStyle = "#f1c40f"; 
        ctx.shadowColor = "#f39c12";
        ctx.shadowBlur = 10;
    } else {
        ctx.fillStyle = "#87ceeb";
        ctx.shadowBlur = 0;
    }
    
    ctx.fillRect(30, -60, 20, 20);
    
    if (isNight) ctx.shadowBlur = 0; 
    
    ctx.strokeStyle = "#5d4037";
    ctx.lineWidth = 2;
    ctx.strokeRect(30, -60, 20, 20);
    
    ctx.restore();
}

function drawTree(ctx, startX, startY, len, angle, width, color, leafColor, isSnowy, sway = 0) {
    ctx.beginPath();
    ctx.save();
    ctx.translate(startX, startY);
    ctx.rotate(0 * Math.PI/180 + sway); 
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    ctx.lineCap = "round";
    
    drawBranch(ctx, len, -Math.PI/2, width, color, leafColor, isSnowy, sway);
    
    ctx.restore();
}

function drawBranch(ctx, len, angle, width, color, leafColor, isSnowy, sway) {
    ctx.lineWidth = width;
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.lineTo(Math.cos(angle) * len, Math.sin(angle) * len);
    ctx.stroke();

    if(len < 10) {
        if (leafColor || isSnowy) {
            ctx.save();
            ctx.translate(Math.cos(angle) * len, Math.sin(angle) * len);
            ctx.fillStyle = isSnowy ? (isNightMode ? "#ccc" : "#fff") : leafColor;
            ctx.beginPath();
            ctx.arc(0, 0, isSnowy ? 6 : 8, 0, Math.PI*2);
            ctx.fill();
            ctx.restore();
        }
        return;
    }

    ctx.save();
    ctx.translate(Math.cos(angle) * len, Math.sin(angle) * len);
    
    let subBranches = 2; 
    for(let i=0; i<subBranches; i++){
        let deviation = (seededRandom() * 0.6) - 0.3; 
        let scale = 0.6 + seededRandom() * 0.2; 
        drawBranch(ctx, len * scale, angle + deviation + (i===0?0.3:-0.3), width * 0.7, color, leafColor, isSnowy, sway);
    }
    
    ctx.restore();
}

function P(x,y,vx,vy,size,alpha=1, color=null){
  this.x=x; this.y=y; this.vx=vx; this.vy=vy; this.s=size; this.a=alpha;
  this.color = color; 
}

function drawParticle(p, shape="dot"){
  ctx.globalAlpha = p.a;
  
  if (shape === "confetti") {
    ctx.fillStyle = p.color || "#fff";
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    ctx.lineTo(p.x + p.s, p.y + p.s * 0.5);
    ctx.lineTo(p.x + p.s * 0.5, p.y + p.s * 1.5);
    ctx.lineTo(p.x - p.s * 0.5, p.y + p.s);
    ctx.fill();
  } else if (shape === "raindrop") {
    ctx.strokeStyle = "rgba(174, 194, 224, " + p.a + ")";
    ctx.lineWidth = 1.5;
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    ctx.lineTo(p.x, p.y + p.s * 5); 
    ctx.stroke();
  } else {
      ctx.beginPath();
      if(shape==="leaf"){
        ctx.ellipse(p.x,p.y,p.s*1.4,p.s*0.7,0,0,Math.PI*2);
      } else if(shape==="flake"){
        ctx.arc(p.x,p.y,p.s,0,Math.PI*2);
      } else {
        ctx.arc(p.x,p.y,p.s,0,Math.PI*2);
      }
      
      if(shape==="flake") ctx.fillStyle = "#ffffff";
      else if (shape==="leaf") ctx.fillStyle = isNightMode ? adjustColorBrightness("#FFB74D", -30) : "#FFB74D"; 
      else ctx.fillStyle = "#ffffff";
      
      ctx.fill();
  }
  
  ctx.globalAlpha = 1;
}

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  bgCtx.clearRect(0,0,bgCanvas.width,bgCanvas.height);
  
  let isDesktop = window.innerWidth >= 1024;
  
  if (isDesktop) {
      let time = Date.now();
      drawUniversalLandscape(bgCtx, bgCanvas.width, bgCanvas.height, time);
  }
  
  for(const p of particles){
    p.x += p.vx; p.y += p.vy;
    
    if (!isCelebration) {
        if(p.a>0.004 && (current.particles==="mist" || current.particles==="soft"|| current.particles==="shimmer")){
          p.a += (Math.random()*0.02 - 0.01);
          p.a = Math.max(0.2, Math.min(0.9, p.a));
        }
    } else {
        p.x += Math.sin(p.y * 0.05) * 0.5;
    }
    
    if(p.y > canvas.height + 20 || p.x > canvas.width + 20 || p.x < -20){
      p.x = Math.random()*canvas.width;
      p.y = -10;
    }
    
    let shape="dot";
    if (isCelebration) {
        shape = "confetti";
    } else {
        if(current.particles==="rain") shape="raindrop";
        else if(current.particles==="leaves") shape="leaf";
        else if(current.particles==="snow") shape="flake";
    }
    
    drawParticle(p, shape);
  }
  raf = requestAnimationFrame(loop);
}

function setParticles(theme){
  particles.length = 0;
  let N = 140;
  
  if (theme === "celebration") {
      N = 180;
      const colors = ["#ffffff", "#fbbf24", "#60a5fa", "#fcd34d"];
      for(let i=0; i<N; i++){
        const x = Math.random()*canvas.width;
        const y = Math.random()*canvas.height;
        const vx = (Math.random() - 0.5) * 1.5;
        const vy = 2 + Math.random() * 4;
        const size = 4 + Math.random() * 4;
        const color = colors[Math.floor(Math.random() * colors.length)];
        particles.push(new P(x, y, vx, vy, size, 1, color));
      }
  } else {
      if(theme==="rain") {
        N = 800; 
      } else if(theme==="soft" || theme==="shimmer" || theme==="mist") {
        N = 90;
      }

      for(let i=0;i<N;i++){
        const x = Math.random()*canvas.width;
        const y = Math.random()*canvas.height;
        if(theme==="rain"){
          particles.push(new P(x,y, 0, 10 + Math.random() * 5, 1.5 + Math.random(), 0.5 + Math.random() * 0.3));
        }else if(theme==="snow"){
          particles.push(new P(x,y, (Math.random()*0.6-0.3), (0.6+Math.random()*0.9), 2.2, 0.95));
        }else if(theme==="leaves"){
          particles.push(new P(x,y, (0.8+Math.random()*0.9), (0.8+Math.random()*0.9), 2, 0.9));
        }else if(theme==="mist"){
          particles.push(new P(x,y, (Math.random()*0.4-0.2), (0.3+Math.random()*0.5), 1.8, 0.45+Math.random()*0.25));
        }else if(theme==="shimmer"){
          particles.push(new P(x,y, (Math.random()*0.3-0.15), (Math.random()*0.3-0.05), 1.6, 0.5+Math.random()*0.35));
        }else if(theme==="soft"){
           particles.push(new P(x,y, (Math.random()*0.1-0.05), (Math.random()*0.2+0.05), 2.5, 0.3+Math.random()*0.3));
        }else{
          particles.push(new P(x,y, (Math.random()*0.25-0.12), (Math.random()*0.35-0.05), 1.4, 0.4+Math.random()*0.4));
        }
      }
  }
  
  if(raf) cancelAnimationFrame(raf);
  loop();
}

card.addEventListener('click', (e) => {
    if (document.body.classList.contains('scenery-mode')) return;

    if (current.key === 'intro') return;
    if (e.target.closest('.btn')) return;
    card.classList.toggle('flipped');
});

function applySlide(s){
  card.classList.remove('flipped');
  
  document.body.style.background = `linear-gradient(120deg, ${s.bg[0]}, ${s.bg[1]})`;

  let textData = isNightMode && s.night ? s.night : s.day;

  badge.textContent = s.badge;
  title.textContent = textData.title;
  desc.innerHTML = textData.desc; 
  quote.innerHTML = textData.quote;
  meter.textContent = `${index+1} / ${slides.length}`;
  
  if(s.img) {
      cardImage.src = s.img;
      hintText.textContent = "(Tap card to see)";
  } else {
      cardImage.src = "";
      hintText.textContent = "";
  }

  setParticles(s.particles);
  updateDisplayMode(); 
  
  if(index === slides.length-1){
    nextBtn.textContent = "Happy Birthday ‚Üí";
  }else{
    nextBtn.textContent = "Next ‚Üí";
  }
}

function fadeTo(idx){
  if (isTransitioning) return;
  isTransitioning = true;
  
  fadeLayer.style.opacity = 1;
  fadeLayer.style.backdropFilter = "blur(12px)";
  fadeLayer.style.webkitBackdropFilter = "blur(12px)";
  
  card.style.opacity = .0;
  card.style.transform = "translateY(8px)";
  
  setTimeout(()=>{
    index = idx;
    current = slides[index];
    applySlide(current);
    
    card.style.opacity = 1;
    card.style.transform = "translateY(0)";
    
    fadeLayer.style.opacity = 0;
    fadeLayer.style.backdropFilter = "blur(0px)";
    fadeLayer.style.webkitBackdropFilter = "blur(0px)";
    
    setTimeout(() => { isTransitioning = false; }, 350);
  }, 420);
}

function startCelebration() {
    if (isTransitioning) return;
    isTransitioning = true;
    
    stage.style.opacity = 0;
    badge.style.opacity = 0;
    
    setTimeout(() => { stage.style.display = 'none'; badge.style.display = 'none'; }, 500);
    
    isCelebration = true;
    setParticles("celebration");
    
    setTimeout(() => {
        celebration.classList.add('active');
        isTransitioning = false;
    }, 500);
}

function goNext() {
  if(index < slides.length-1){
    fadeTo(index+1);
  } else {
    startCelebration();
  }
}

initBirds();
applySlide(current);

nextBtn.addEventListener('click', (e)=>{
  e.stopPropagation();
  goNext();
});

stage.addEventListener('click', (e) => {
  if (isCelebration) return;
  if (e.target.closest('.card')) return;
  goNext();
});

document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.nav-link');
    const mainContent = document.getElementById('mainContent');
    
    const sidebar = document.getElementById('sidebar');
    const topNav = document.getElementById('topNav');
    const bottomNav = document.getElementById('bottomNav');
    const leftNav = document.getElementById('leftNav');
    const rightNav = document.getElementById('rightNav');
    
    const navToggle = document.getElementById('navToggle');
    const navToggleIcon = document.getElementById('navToggleIcon');
    const navToggleX = document.getElementById('navToggleX');
    
    const themeToggle = document.getElementById('themeToggle');
    const themeToggleIconSun = document.getElementById('themeToggleIconSun');
    const themeToggleIconMoon = document.getElementById('themeToggleIconMoon');

    let isNavOpen = false;

    function isDesktop() {
        return window.innerWidth >= 1024;
    }

    function openNav() {
        if (isDesktop()) {
            sidebar.classList.remove('-translate-x-full');
        } else {
            topNav.classList.remove('-translate-y-full');
            bottomNav.classList.remove('translate-y-full');
            leftNav.classList.remove('-translate-x-full');
            rightNav.classList.remove('translate-x-full');
            mainContent.classList.add('pt-16', 'pb-16', 'pl-24', 'pr-24');
            mainContent.classList.remove('pt-28');
        }
        
        navToggleIcon.classList.add('hidden');
        navToggleX.classList.remove('hidden');
        isNavOpen = true;
    }

    function closeNav() {
        if (isDesktop()) {
            sidebar.classList.add('-translate-x-full');
        } else {
            topNav.classList.add('-translate-y-full');
            bottomNav.classList.add('translate-y-full');
            leftNav.classList.add('-translate-x-full');
            rightNav.classList.add('translate-x-full');
            mainContent.classList.remove('pt-16', 'pb-16', 'pl-24', 'pr-24');
            mainContent.classList.add('pt-28');
        }
        
        navToggleIcon.classList.remove('hidden');
        navToggleX.classList.add('hidden');
        isNavOpen = false;
    }

    function toggleNav() {
        if (isNavOpen) {
            closeNav();
        } else {
            openNav();
        }
    }

    navToggle.addEventListener('click', (e) => {
        e.stopPropagation(); 
        toggleNav();
    });
    
    themeToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        isNightMode = !isNightMode;
        
        if (isNightMode) {
            themeToggleIconSun.classList.add('hidden');
            themeToggleIconMoon.classList.remove('hidden');
        } else {
            themeToggleIconSun.classList.remove('hidden');
            themeToggleIconMoon.classList.add('hidden');
        }

        applySlide(current);
        checkAudio(); 
    });
    
    document.addEventListener('click', (e) => {
        if (isNavOpen) {
            let clickedInside = false;
            if (isDesktop()) {
                if (sidebar.contains(e.target)) clickedInside = true;
            } else {
                if (topNav.contains(e.target) || bottomNav.contains(e.target) || 
                    leftNav.contains(e.target) || rightNav.contains(e.target)) {
                    clickedInside = true;
                }
            }
            
            if (!clickedInside && !navToggle.contains(e.target)) {
                closeNav();
            }
        }
    });
    
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
             closeNav();
        });
    });
    
    window.addEventListener('resize', () => {
        if (isNavOpen) {
            closeNav(); 
        }
    });
});
</script>
</body>
</html>