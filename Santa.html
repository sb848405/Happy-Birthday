<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Christmas Birthday Wish</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&family=Inter:wght@400;500;700&family=Pacifico&family=Playfair+Display:ital,wght@1,700&display=swap" rel="stylesheet">

    <style>
        .nav-panel, #mainContent, #navToggleIcon, #navToggleX, #desktopNav {
            transition: all 0.3s ease-in-out;
        }
        #mainContent, .nav-panel, #desktopNav {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #mainContent::-webkit-scrollbar,
        .nav-panel::-webkit-scrollbar,
        #desktopNav::-webkit-scrollbar {
            display: none;
        }
        .festive-text {
            font-family: 'Gochi Hand', cursive;
        }
        .elegant-text {
            font-family: 'Playfair Display', serif;
        }
        
        @media (min-width: 768px) {
            body {
                cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='%2338bdf8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><line x1='2' y1='12' x2='22' y2='12'></line><line x1='12' y1='2' x2='12' y2='22'></line><line x1='4.93' y1='4.93' x2='19.07' y2='19.07'></line><line x1='4.93' y1='19.07' x2='19.07' y2='4.93'></line></svg>") 16 16, auto;
            }
        }

        body {
            background-color: #000000;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            color: #d1d5db;
        }
        
        h1, h2, h3 {
            font-family: 'Pacifico', cursive;
        }

        button {
            user-select: none;
        }
        
        #mainContent {
            position: absolute;
            inset: 0;
            min-height: 100vh;  
            overflow-y: hidden;
            padding-top: 4rem;
        }

        .desktop-scene-bg {
            background: linear-gradient(to bottom, #020617 0%, #172554 60%, #1e3a8a 100%);
        }
        
        .moon-glow {
            box-shadow: 0 0 60px 20px rgba(253, 224, 71, 0.3), inset 0 0 50px rgba(253, 224, 71, 0.2);
        }

        .festive-bg {
            background: linear-gradient(135deg, #0d1226 0%, #000000 100%);
        }

        .card-festive {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.4);
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        
        .card-festive:hover {
            transform: translateY(-5px);
        }

        .bg-candy-cane {
            background: repeating-linear-gradient(
                45deg,
                #ef4444,
                #ef4444 10px,
                #ffffff 10px,
                #ffffff 20px,
                #22c55e 20px,
                #22c55e 30px,
                #ffffff 30px,
                #ffffff 40px
            );
        }

        .text-shadow-glow {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .full-screen-stage {
            height: 100%; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 1s ease-in-out;
            position: relative;
        }

        #stage-0 {
            background-color: #e0f2fe;
            background-image: 
                radial-gradient(#ffffff 1.5px, transparent 0), 
                radial-gradient(#ffffff 1.5px, transparent 0);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }

        @media (min-width: 768px) {
            #stage-0 {
                background: transparent;
            }
        }

        #stage-1 {
            background: radial-gradient(ellipse at bottom, #0d1226 0%, #000000 100%);
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, #fff, rgba(0,0,0,0)), 
                radial-gradient(1.5px 1.5px at 90px 70px, #fff, rgba(0,0,0,0)), 
                radial-gradient(1.5px 1.5px at 150px 10px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 50px 120px, #eee, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 10px 100px, #eee, rgba(0,0,0,0)),
                radial-gradient(0.5px 0.5px at 120px 40px, #ddd, rgba(0,0,0,0)),
                radial-gradient(0.5px 0.5px at 200px 150px, #ddd, rgba(0,0,0,0));
            background-size: 250px 250px;
        }
        
        @media (min-width: 768px) {
            #stage-1, .festive-bg {
                background: transparent;
                background-image: none;
            }
        }

        .moon-container {
            width: 300px;
            height: 300px;
            position: relative;
            border-radius: 50%;
            z-index: 10;
            overflow: hidden; 
            background: transparent;
            
            box-shadow: inset -20px -20px 60px rgba(0,0,0,0.8), 
                        inset 5px 5px 20px rgba(255,255,255,0.4),
                        0 0 60px rgba(255,255,255,0.1); 
            transition: box-shadow 1.5s ease;
        }

        .moon-container::after {
            content: '';
            position: absolute;
            top: 10%;
            left: 15%;
            width: 35%;
            height: 25%;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
            filter: blur(6px);
            z-index: 30; 
            pointer-events: none;
        }
        
        @media (min-width: 768px) {
            .moon-container {
                width: 24rem;
                height: 24rem;
            }
        }
        @media (min-width: 1280px) {
            .moon-container {
                width: 24rem;
                height: 24rem;
            }
        }

        .moon-slider {
            display: flex;
            width: 200%; 
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            will-change: transform;
        }

        .moon-panel {
            width: 50%; 
            height: 100%;
            background-size: cover;
            background-position: center;
        }

        .moon-spinning {
            animation: spinSlide 4s ease-in-out forwards;
        }

        @keyframes spinSlide {
            0% { transform: translateX(0%); filter: blur(0px); }
            40% { filter: blur(8px); } 
            60% { filter: blur(8px); }
            100% { transform: translateX(-50%); filter: blur(0px); }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: inset -20px -20px 60px rgba(0,0,0,0.8), inset 5px 5px 20px rgba(255,255,255,0.4), 0 0 50px rgba(255,255,255,0.8); }
            50% { box-shadow: inset -20px -20px 60px rgba(0,0,0,0.8), inset 5px 5px 20px rgba(255,255,255,0.4), 0 0 90px rgba(255,255,255,1); }
        }

        .moon-container.magical {
            animation: pulse-glow 3s infinite ease-in-out;
        }

        #moon-instruction {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 60; 
            pointer-events: none;
            transition: all 0.5s ease;
        }
        
        .moon-tracker-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.2);
            transition: all 0.5s ease;
            box-shadow: 0 0 5px rgba(255,255,255,0.1);
        }
        .moon-tracker-dot.active {
            transform: scale(1.5);
            box-shadow: 0 0 15px currentColor;
        }

        .hanging-light {
            animation: swing 3s ease-in-out infinite alternate;
            transform-origin: top center;
        }
        @keyframes swing {
            0% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle {
            animation: wiggle 2s ease-in-out infinite;
        }
        
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }
        
        @keyframes float-y {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .animate-float {
            animation: float-y 4s ease-in-out infinite;
        }
        
        @keyframes shake-x {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .animate-shake {
            animation: shake-x 1s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        @keyframes fly-across {
            0% { transform: translate(120vw, 20vh) scale(0.5) rotate(-5deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(-20vw, -10vh) scale(0.8) rotate(0deg); opacity: 0; }
        }

        .santa-fly {
            animation: fly-across 20s linear infinite;
        }

        .gift-pop-transition {
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ffd300;
            top: -10px;
            z-index: 5;
            animation: confettiFall linear forwards;
        }
        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        .floating-balloon {
            position: absolute;
            bottom: -100px;
            font-size: 4rem;
            animation: floatUp 8s ease-in-out infinite;
            opacity: 0.8;
            z-index: 1;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-50vh) rotate(10deg); }
            100% { transform: translateY(-120vh) rotate(-10deg); }
        }
        
        .snow-particle {
            position: fixed;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            opacity: 0.8;
            animation: fadeOut 1s forwards;
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(20px); }
        }
        
        .stage-snow {
            position: absolute;
            top: -10px;
            color: white;
            font-size: 1.5rem;
            animation: snowDrop linear infinite;
            text-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        @keyframes snowDrop {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        @keyframes santa-fly-by {
            0% { left: -30%; top: 10%; transform: rotate(5deg) scale(0.8); }
            40% { top: 15%; transform: rotate(0deg) scale(1); }
            60% { top: 15%; transform: rotate(0deg) scale(1); }
            100% { left: 120%; top: 5%; transform: rotate(-5deg) scale(0.8); }
        }
        .animate-santa-fly-by {
            animation: santa-fly-by 8s linear forwards;
        }

        @keyframes letter-drop {
            0% { top: 15%; opacity: 0; transform: translate(-50%, 0) scale(0.2) rotate(0deg); }
            20% { opacity: 1; }
            80% { top: 50%; transform: translate(-50%, -50%) scale(1.1) rotate(720deg); }
            100% { top: 50%; opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(720deg); }
        }
        .animate-letter-drop {
            animation: letter-drop 2s ease-out forwards;
        }
        
        .box-lid {
            transition: transform 0.5s ease-out;
            transform-origin: bottom center;
        }
        .box-open .box-lid {
            transform: translateY(-40px) rotate(-20deg);
            opacity: 0;
        }
        .gift-item {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: scale(0);
            opacity: 0;
        }
        .box-open .gift-item {
            transform: scale(1);
            opacity: 1;
        }
        
        @keyframes deep-night-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .bg-finale-desktop {
            background: linear-gradient(135deg, #020617 0%, #1e1b4b 25%, #172554 50%, #1e1b4b 75%, #020617 100%);
            background-size: 400% 400%;
            animation: deep-night-shift 15s ease infinite;
        }
        
        .letter-texture {
            background-color: #fffbeb;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%2394a3b8' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), inset 0 0 20px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="antialiased bg-black overflow-hidden text-gray-800">

    <audio id="bg-music" loop>
        <source src="santa.mp3" type="audio/mpeg">
    </audio>

    <div id="desktop-bg-scene" class="hidden md:block fixed inset-0 z-0 overflow-hidden desktop-scene-bg pointer-events-none">
        
        <div class="absolute inset-0 opacity-80" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 50px 50px;"></div>
        <div class="absolute inset-0 opacity-50" style="background-image: radial-gradient(white 1.5px, transparent 1.5px); background-size: 120px 120px; background-position: 20px 20px;"></div>

        <div id="desktop-snow-container" class="absolute inset-0 pointer-events-none z-10">
            <div class="stage-snow left-[5%]" style="animation-duration: 10s;">‚ùÑÔ∏è</div>
            <div class="stage-snow left-[15%]" style="animation-duration: 14s; animation-delay: 2s;">‚ùÖ</div>
            <div class="stage-snow left-[25%]" style="animation-duration: 11s; animation-delay: 4s;">‚ùÜ</div>
            <div class="stage-snow left-[40%]" style="animation-duration: 16s; animation-delay: 1s;">‚ùÑÔ∏è</div>
            <div class="stage-snow left-[55%]" style="animation-duration: 9s; animation-delay: 3s;">‚ùÖ</div>
            <div class="stage-snow left-[70%]" style="animation-duration: 13s; animation-delay: 5s;">‚ùÜ</div>
            <div class="stage-snow left-[85%]" style="animation-duration: 15s; animation-delay: 0s;">‚ùÑÔ∏è</div>
            <div class="stage-snow left-[10%]" style="animation-duration: 8s; animation-delay: 0s;">‚ùÑÔ∏è</div>
            <div class="stage-snow left-[20%]" style="animation-duration: 12s; animation-delay: 2s;">‚ùÖ</div>
            <div class="stage-snow left-[35%]" style="animation-duration: 10s; animation-delay: 4s;">‚ùÜ</div>
            <div class="stage-snow left-[50%]" style="animation-duration: 15s; animation-delay: 1s;">‚ùÑÔ∏è</div>
            <div class="stage-snow left-[65%]" style="animation-duration: 9s; animation-delay: 3s;">‚ùÖ</div>
            <div class="stage-snow left-[80%]" style="animation-duration: 11s; animation-delay: 5s;">‚ùÜ</div>
            <div class="stage-snow left-[90%]" style="animation-duration: 13s; animation-delay: 0s;">‚ùÑÔ∏è</div>
        </div>

        <div class="absolute top-8 left-0 right-0 text-center z-20">
            <h1 class="elegant-text text-3xl md:text-5xl text-yellow-100 italic drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)] tracking-wider">
                Merry Christmas
            </h1>
        </div>

        <div id="static-moon" class="absolute top-[20%] left-1/2 transform -translate-x-1/2 w-96 h-96 rounded-full bg-yellow-100 moon-glow opacity-90 transition-opacity duration-1000"></div>

        <div class="absolute top-[25%] left-0 w-full h-full santa-fly z-10 opacity-90">
            <svg viewBox="0 0 500 200" width="600" height="240" fill="black" class="opacity-80">
                 <path d="M450,150 Q460,140 470,150 T490,140 L480,160 H420 Z" fill="#b91c1c"/> 
                 <rect x="440" y="155" width="40" height="10" rx="2" /> 
                 <circle cx="455" cy="145" r="5" /> 
                 <path d="M400,160 Q410,140 420,160 T440,160" stroke="black" stroke-width="2" fill="none"/> 
                 <path d="M350,150 Q360,140 370,150 L370,170 L350,170 Z" />
                 <path d="M300,145 Q310,135 320,145 L320,165 L300,165 Z" />
                 <path d="M250,140 Q260,130 270,140 L270,160 L250,160 Z" />
            </svg>
        </div>

        <div class="absolute bottom-0 left-0 right-0 h-[45vh] w-full z-10">
            <svg viewBox="0 0 1440 320" preserveAspectRatio="none" class="w-full h-full">
                <path fill="#475569" fill-opacity="1" d="M0,128L48,144C96,160,192,192,288,197.3C384,203,480,181,576,165.3C672,149,768,139,864,149.3C960,160,1056,192,1152,192C1248,192,1344,160,1392,144L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
                <path fill="#cbd5e1" fill-opacity="1" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
                <path fill="#f1f5f9" fill-opacity="1" d="M0,256L60,245.3C120,235,240,213,360,213.3C480,213,600,235,720,240C840,245,960,235,1080,224C1200,213,1320,203,1380,197.3L1440,192L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path>
                
                <polygon points="100,240 120,200 140,240" fill="#1e293b" />
                <polygon points="110,210 120,190 130,210" fill="#1e293b" />
                <polygon points="850,230 880,180 910,230" fill="#0f172a" />
                <polygon points="1200,210 1230,160 1260,210" fill="#0f172a" />
                
                <!-- Extra Trees for density -->
                <polygon points="40,240 60,190 80,240" fill="#064e3b" />
                <polygon points="150,230 170,170 190,230" fill="#065f46" />
                <polygon points="450,220 470,160 490,220" fill="#0f172a" />
                <polygon points="800,230 820,180 840,230" fill="#064e3b" />
                <polygon points="1300,220 1320,170 1340,220" fill="#065f46" />

                <!-- New House Left -->
                <rect x="160" y="250" width="30" height="30" fill="#4f46e5" />
                <polygon points="155,250 175,225 195,250" fill="#312e81" />
                <rect x="170" y="260" width="10" height="20" fill="#fef3c7" />

                <rect x="250" y="240" width="40" height="40" fill="#be123c" />
                <polygon points="240,240 270,210 300,240" fill="#451a03" />
                <rect x="260" y="255" width="10" height="25" fill="#fef3c7" /> 
                <rect x="275" y="250" width="10" height="10" fill="#fef9c3" /> 

                <!-- New House Middle-Left -->
                <rect x="400" y="255" width="35" height="35" fill="#ca8a04" />
                <polygon points="395,255 417,230 440,255" fill="#713f12" />
                <rect x="412" y="270" width="12" height="20" fill="#fef3c7" />

                <rect x="600" y="260" width="50" height="40" fill="#047857" />
                <polygon points="590,260 625,230 660,260" fill="#451a03" />
                <rect x="620" y="275" width="10" height="25" fill="#fef3c7" />
                
                <!-- New House Middle-Right -->
                <rect x="750" y="250" width="40" height="40" fill="#7c3aed" />
                <polygon points="740,250 770,220 800,250" fill="#4c1d95" />
                <rect x="755" y="265" width="10" height="25" fill="#fef3c7" />
                <rect x="775" y="260" width="10" height="10" fill="#fef9c3" />

                <rect x="1050" y="245" width="45" height="45" fill="#d97706" />
                <polygon points="1040,245 1072,215 1105,245" fill="#451a03" />
                <rect x="1065" y="265" width="12" height="25" fill="#fef3c7" />
                <rect x="1055" y="255" width="8" height="8" fill="#fef9c3" />
                <rect x="1080" y="255" width="8" height="8" fill="#fef9c3" />

                 <!-- New House Right -->
                <rect x="1250" y="255" width="35" height="35" fill="#0ea5e9" />
                <polygon points="1245,255 1267,230 1290,255" fill="#0c4a6e" />
                <rect x="1262" y="270" width="12" height="20" fill="#fef3c7" />

                 <!-- Igloo -->
                 <path d="M1150,280 A30,30 0 0,1 1210,280" fill="#e2e8f0" stroke="#94a3b8" stroke-width="2" />
                 <path d="M1150,280 H1210" fill="#e2e8f0" />
                 <path d="M1170,280 A10,10 0 0,1 1190,280" fill="#1e293b" />
                 <line x1="1165" y1="260" x2="1195" y2="260" stroke="#cbd5e1" stroke-width="1" />
                 <line x1="1180" y1="250" x2="1180" y2="280" stroke="#cbd5e1" stroke-width="1" />
            </svg>
        </div>
    </div>
    
    <button id="navToggle" class="fixed top-6 left-6 z-[90] p-2 bg-blue-600 text-yellow-300 rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        <svg id="navToggleIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-8 6h8"></path></svg>
        <svg id="navToggleX" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>
    
    <button id="musicToggle" class="hidden md:flex fixed top-6 right-6 z-[90] p-2 bg-white/10 backdrop-blur-md border border-white/20 text-yellow-300 rounded-full shadow-lg hover:bg-white/20 focus:outline-none transition-all hidden">
        <svg id="musicIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
        </svg>
        <svg id="musicOffIcon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
        </svg>
    </button>

    <nav id="topNav" class="nav-panel md:hidden fixed top-0 left-0 right-0 z-[85] h-16 bg-indigo-900 text-yellow-300 shadow-md flex items-center justify-center space-x-2 -translate-y-full">
        <a href="Msg.html" onclick="handleNavClick('Message');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Message</a>
        <a href="letter.html" onclick="handleNavClick('Letter');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">Letter</a>
        <a href="Music.html" onclick="handleNavClick('Music');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Music</a>
    </nav>
    
    <nav id="bottomNav" class="nav-panel md:hidden fixed bottom-0 left-0 right-0 z-[85] h-16 bg-indigo-900 text-yellow-300 shadow-md flex items-center justify-center space-x-2 translate-y-full">
        <a href="Skill.html" onclick="handleNavClick('Skill');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Skill</a>
        <a href="Paper_Star.html" onclick="handleNavClick('Paper Star');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Paper Star</a>
        <a href="Carttoon.html" onclick="handleNavClick('Cartoon');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Cartoon</a>
    </nav>
    
    <nav id="leftNav" class="nav-panel md:hidden fixed left-0 top-0 bottom-0 z-[80] w-20 bg-gray-900 text-cyan-300 shadow-md flex flex-col items-center space-y-2 -translate-x-full overflow-y-auto py-16">
        <a href="index.html" onclick="handleNavClick('Home');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">Home</a>
        <a href="Cake.html" onclick="handleNavClick('Cake');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Cake</a>
        <a href="21_Wish.html" onclick="handleNavClick('21_Door');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">21_Door</a>
        <a href="chat.html" onclick="handleNavClick('Heaven');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">Heaven</a>
        <a href="Diary.html" onclick="handleNavClick('Diary');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Diary</a>
        <a href="anatomy.html" onclick="handleNavClick('Anatomy');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">Anatomy</a>
        <a href="Box.html" onclick="handleNavClick('Box');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Box</a>
        <a href="Special.html" onclick="handleNavClick('Special');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">Special</a>
        <a href="color.html" onclick="handleNavClick('Color');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Color</a>
        <a href="you.html" onclick="handleNavClick('You');" class="nav-link px-3 py-2 rounded-md text-sm font-medium hover:bg-indigo-800 transition-colors duration-200 festive-text">You</a>
        <a href="Teacher.html" onclick="handleNavClick('Teacher');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Teacher</a>
        <a href="Universe.html" onclick="handleNavClick('Universe');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Universe</a>
        <a href="The_River.html" onclick="handleNavClick('River');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">River</a>
        <a href="Mountain.html" onclick="handleNavClick('Mountain');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Mountain</a>
    </nav>
    
    <nav id="rightNav" class="nav-panel md:hidden fixed right-0 top-0 bottom-0 z-[80] w-20 bg-gray-900 text-cyan-300 shadow-md flex flex-col items-center space-y-2 translate-x-full overflow-y-auto py-16">
        <a href="Periodik_table.html" onclick="handleNavClick('Periodik_table');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Periodik_table</a>
        <a href="Concept.html" onclick="handleNavClick('Concept');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Concept</a>
        <a href="Calender.html" onclick="handleNavClick('Calender');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Calender</a>
        <a href="Perspective.html" onclick="handleNavClick('Perspective');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Perspective</a>
        <a href="Santa.html" onclick="handleNavClick('Santa');" class="nav-link p-2 rounded-md text-sm font-medium bg-yellow-500/20 text-yellow-200 border border-yellow-500/30 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text">Santa</a>
        <a href="Presence.html" onclick="handleNavClick('Presence');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Presence</a>
        <a href="Cloud.html" onclick="handleNavClick('Cloud');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Cloud</a>
        <a href="Ink.html" onclick="handleNavClick('Paint');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Paint</a>
        <a href="Butterfly.html" onclick="handleNavClick('Butterfly');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Butterfly</a>
        <a href="Weather.html" onclick="handleNavClick('Weather');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Weather</a>
        <a href="Spotlight.html" onclick="handleNavClick('Spotlight');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Spotlight</a>
        <a href="Room.html" onclick="handleNavClick('Room');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Room</a>
        <a href="Radio.html" onclick="handleNavClick('Radio');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Radio</a>
        <a href="Food.html" onclick="handleNavClick('Food');" class="nav-link p-2 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors duration-200 festive-text">Food</a>
    </nav>

    <nav id="desktopNav" class="hidden md:flex flex-col fixed left-0 top-0 bottom-0 z-[80] w-96 bg-slate-900/90 backdrop-blur-sm border-r border-indigo-900 text-cyan-300 shadow-2xl -translate-x-full pt-20 pb-10 overflow-y-auto">
        <div class="px-6 mb-4">
            <h2 class="text-3xl text-yellow-300 border-b border-gray-700 pb-2 text-center">Christmas Menu</h2>
        </div>
        <div class="grid grid-cols-2 gap-3 px-4 w-full">
            <a href="index.html" onclick="handleNavClick('Home');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Home</a>
            <a href="Cake.html" onclick="handleNavClick('Cake');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Cake</a>
            
            <a href="21_Wish.html" onclick="handleNavClick('21_Door');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">21_Door</a>
            <a href="chat.html" onclick="handleNavClick('Heaven');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Heaven</a>
            
            <a href="Diary.html" onclick="handleNavClick('Diary');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Diary</a>
            <a href="anatomy.html" onclick="handleNavClick('Anatomy');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Anatomy</a>
            
            <a href="Box.html" onclick="handleNavClick('Box');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Box</a>
            <a href="Special.html" onclick="handleNavClick('Special');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Special</a>
            
            <a href="color.html" onclick="handleNavClick('Color');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Color</a>
            <a href="you.html" onclick="handleNavClick('You');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">You</a>
            
            <a href="Teacher.html" onclick="handleNavClick('Teacher');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Teacher</a>
            <a href="Universe.html" onclick="handleNavClick('Universe');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Universe</a>
            
            <a href="The_River.html" onclick="handleNavClick('River');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">River</a>
            <a href="Mountain.html" onclick="handleNavClick('Mountain');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Mountain</a>
            
            <a href="Skill.html" onclick="handleNavClick('Skill');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Skill</a>
            <a href="Paper_Star.html" onclick="handleNavClick('Paper Star');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Paper Star</a>
            
            <a href="Carttoon.html" onclick="handleNavClick('Cartoon');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Cartoon</a>
            <a href="Periodik_table.html" onclick="handleNavClick('Periodik_table');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Periodik_table</a>
            
            <a href="Concept.html" onclick="handleNavClick('Concept');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Concept</a>
            <a href="Calender.html" onclick="handleNavClick('Calender');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text">Calender</a>
            
            <a href="Perspective.html" onclick="handleNavClick('Perspective');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Perspective</a>
            <a href="Santa.html" onclick="handleNavClick('Santa');" class="nav-link p-3 rounded-md text-sm font-medium bg-yellow-500/20 text-yellow-200 border border-yellow-500/30 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text">Santa</a>
            
            <a href="Presence.html" onclick="handleNavClick('Presence');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Presence</a>
            <a href="Cloud.html" onclick="handleNavClick('Cloud');" class="nav-link p-3 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Cloud</a>
            
            <a href="Ink.html" onclick="handleNavClick('Paint');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Paint</a>
            <a href="Butterfly.html" onclick="handleNavClick('Butterfly');" class="nav-link p-3 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Butterfly</a>
            
            <a href="Weather.html" onclick="handleNavClick('Weather');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text">Weather</a>
            <a href="Spotlight.html" onclick="handleNavClick('Spotlight');" class="nav-link p-3 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Spotlight</a>
            
            <a href="Room.html" onclick="handleNavClick('Room');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Room</a>
            <a href="Radio.html" onclick="handleNavClick('Radio');" class="nav-link p-3 rounded-md text-sm font-medium hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Radio</a>
            
            <a href="Food.html" onclick="handleNavClick('Food');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Food</a>
            <a href="Music.html" onclick="handleNavClick('Music');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Music</a>
            
            <a href="letter.html" onclick="handleNavClick('Letter');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-green-700 hover:text-white transition-colors duration-200 festive-text text-center">Letter</a>
            <a href="Msg.html" onclick="handleNavClick('Message');" class="nav-link p-3 rounded-md text-sm font-medium bg-white/10 hover:bg-red-700 hover:text-white transition-colors duration-200 festive-text text-center">Message</a>
        </div>
    </nav>

    <div id="mainContent" class="pt-16">

        <div id="stage-0" class="full-screen-stage p-4">
            <div class="hidden md:block pointer-events-none fixed inset-0 z-[70]">
                <!-- Removed top left hanging light -->
                
                <div class="absolute top-0 right-20 hanging-light" style="animation-delay: 0.5s;">
                    <div class="w-1 h-16 bg-gray-600 mx-auto"></div>
                    <div class="w-8 h-8 rounded-full bg-yellow-400 shadow-[0_0_20px_rgba(250,204,21,0.8)]"></div>
                </div>
                <div class="absolute top-0 right-40 hanging-light" style="animation-delay: 1.5s;">
                    <div class="w-1 h-24 bg-gray-600 mx-auto"></div>
                    <div class="w-8 h-8 rounded-full bg-blue-500 shadow-[0_0_20px_rgba(59,130,246,0.8)]"></div>
                </div>
            </div>

            <div class="w-full max-w-md bg-white card-festive p-8 text-center relative z-[60] md:hidden">
                <div class="absolute top-0 left-0 right-0 h-3 bg-candy-cane"></div>
                <span class="text-7xl mb-4 block animate-bounce mt-4">üéÅ</span>
                <h1 class="text-3xl font-extrabold text-red-600 font-pacifico">
                    A Message from the North Pole!
                </h1>
                <p class="text-lg text-gray-700 mt-6 font-medium leading-relaxed font-inter">
                    "Welcome, Beautiful Soul! ‚ú®<br>
                    Ho ho ho! The stars have whispered that someone incredible is celebrating today. A spirit so bright, you light up the darkest winter nights."
                </p>
                <button onclick="goToStage(1)" class="mt-8 w-full px-6 py-3 bg-red-600 text-white font-black text-xl rounded-full shadow-lg hover:bg-red-700 transition transform hover:scale-105 active:scale-95">
                    Start the Journey
                </button>
            </div>

            <div class="hidden md:flex flex-col items-center text-center z-[60] relative -mt-20">
                <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-b from-yellow-200 to-yellow-400 font-pacifico drop-shadow-[0_0_10px_rgba(253,224,71,0.5)] mb-6">
                    A Message from the North Pole!
                </h1>
                <p class="text-xl text-yellow-50 font-medium leading-relaxed font-inter drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] max-w-3xl">
                    "Welcome, Beautiful Soul! ‚ú®<br>
                    Ho ho ho! The stars have whispered that someone incredible is celebrating today.<br>
                    A spirit so bright, you light up the darkest winter nights."
                </p>
                <button onclick="goToStage(1)" class="mt-10 px-8 py-3 bg-red-600/90 hover:bg-red-500 text-white font-black text-xl rounded-full shadow-[0_0_20px_rgba(239,68,68,0.6)] transition-all transform hover:scale-110 active:scale-95 border border-white/30 backdrop-blur-sm">
                    Start the Journey
                </button>
            </div>
        </div>

        <div id="stage-1" class="full-screen-stage hidden p-4 flex-col overflow-hidden">
            <div id="moon-tracker" class="flex space-x-4 mb-8 absolute top-8 left-1/2 transform -translate-x-1/2 z-20">
            </div>

            <div class="w-full h-full relative z-10 flex flex-col items-center justify-center md:block">
                
                <div class="order-1 md:fixed md:top-[20%] md:left-1/2 md:-translate-x-1/2 z-50">
                      <div id="moon-wrapper" class="moon-container cursor-pointer relative md:w-96 md:h-96">
                        <div id="moon-slider" class="moon-slider">
                            <div id="moon-panel-left" class="moon-panel"></div>
                            <div id="moon-panel-right" class="moon-panel"></div>
                        </div>
                        
                        <p id="moon-instruction" class="text-lg font-bold text-indigo-900 bg-white/80 px-6 py-2 rounded-full shadow-lg backdrop-blur-md transition-all duration-500 hover:scale-110 pointer-events-none select-none animate-pulse">
                            Tap Me!
                        </p>
                    </div>
                </div>

                <div class="order-2 mt-8 md:absolute md:top-1/2 md:-translate-y-1/2 md:right-2 md:left-auto md:bottom-auto md:mt-0 flex flex-col items-center md:items-end z-20 w-full md:w-[45%] pointer-events-none">
                      <h2 class="text-xl md:text-2xl font-semibold text-yellow-300 mb-4 font-pacifico drop-shadow-lg text-center md:text-right pointer-events-auto">
                        Find the hidden portal in the night sky...
                      </h2>
                      
                      <div class="min-h-[8rem] flex items-center justify-center md:justify-end px-4">
                        <p id="moon-caption" class="text-lg md:text-xl lg:text-2xl font-bold text-yellow-50 transition-opacity duration-1000 opacity-0 whitespace-pre-line leading-relaxed drop-shadow-md font-inter text-center md:text-right pointer-events-auto max-w-4xl">
                            The Night Sky is Changing... Wait for the Magic.
                        </p>
                      </div>

                      <div class="relative w-full mt-4 h-16 flex justify-center md:justify-end gap-4 pointer-events-auto"> 
                        <button id="pause-toggle-btn" onclick="togglePause()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold text-lg rounded-full shadow-xl transition duration-300 opacity-0 hidden">
                            <span id="pause-text">Pause</span>
                        </button>
                        <button id="moon-next-btn" onclick="goToStage(2)" class="px-6 py-2 bg-pink-600 hover:bg-pink-500 text-white font-bold text-lg rounded-full shadow-xl transition duration-500 opacity-0 cursor-default" disabled>
                            Continue to Video Message
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="stage-2" class="full-screen-stage bg-gray-900 md:bg-transparent hidden relative p-4 justify-center overflow-hidden">
            
            <div id="snow-container-stage2" class="absolute inset-0 pointer-events-none z-0">
                <div class="stage-snow left-[10%]" style="animation-duration: 8s; animation-delay: 0s;">‚ùÑÔ∏è</div>
                <div class="stage-snow left-[20%]" style="animation-duration: 12s; animation-delay: 2s;">‚ùÖ</div>
                <div class="stage-snow left-[35%]" style="animation-duration: 10s; animation-delay: 4s;">‚ùÜ</div>
                <div class="stage-snow left-[50%]" style="animation-duration: 15s; animation-delay: 1s;">‚ùÑÔ∏è</div>
                <div class="stage-snow left-[65%]" style="animation-duration: 9s; animation-delay: 3s;">‚ùÖ</div>
                <div class="stage-snow left-[80%]" style="animation-duration: 11s; animation-delay: 5s;">‚ùÜ</div>
                <div class="stage-snow left-[90%]" style="animation-duration: 13s; animation-delay: 0s;">‚ùÑÔ∏è</div>
            </div>

            <div class="absolute top-0 left-0 right-0 h-16 pointer-events-none z-0 flex justify-between px-4 overflow-hidden md:hidden">
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 3s;">üí°</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 4s; animation-delay: 1s;">üéÑ</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 3.5s; animation-delay: 0.5s;">üí°</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 4.5s; animation-delay: 1.5s;">‚≠ê</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 3s; animation-delay: 2s;">üí°</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 4s; animation-delay: 0.8s;">üéÅ</div>
                <div class="text-4xl animate-swing origin-top" style="animation-duration: 3.2s; animation-delay: 1.2s;">üí°</div>
            </div>

            <div class="absolute left-0 top-0 bottom-0 w-1/4 pointer-events-none hidden overflow-hidden z-0">
                <div class="absolute top-10 left-10 text-6xl animate-bounce filter drop-shadow-lg" style="animation-duration: 3s;">üéÖ</div>
                <div class="absolute top-1/4 left-4 text-4xl animate-pulse text-yellow-300">‚≠ê</div>
                <div class="absolute top-1/3 left-16 text-6xl animate-wiggle filter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">‚òÉÔ∏è</div>
                <div class="absolute bottom-1/2 left-8 text-5xl animate-float">üß¶</div>
                <div class="absolute bottom-1/4 left-12 text-4xl animate-bounce" style="animation-delay: 1s;">üéÅ</div>
                <div class="absolute bottom-10 left-20 text-5xl animate-spin-slow">üç¨</div>
                <div class="absolute top-0 left-24 w-0.5 h-40 bg-gray-500/30"></div>
                <div class="absolute top-40 left-20 text-4xl animate-swing origin-top">üîî</div>
            </div>

            <div class="absolute right-0 top-0 bottom-0 w-1/4 pointer-events-none hidden overflow-hidden z-0">
                <div class="absolute top-0 right-10 w-1 h-32 bg-gray-400/30"></div>
                <div class="absolute top-32 right-6 text-5xl animate-bounce filter drop-shadow-lg">üîî</div>
                
                <div class="absolute top-0 right-24 w-1 h-64 bg-gray-400/30"></div>
                <div class="absolute top-64 right-20 text-6xl animate-pulse filter drop-shadow-lg">‚ú®</div>

                <div class="absolute top-1/3 right-10 text-5xl animate-float" style="animation-delay: 2s;">üéÄ</div>
                <div class="absolute top-1/2 right-4 text-4xl animate-spin-slow filter drop-shadow-lg">‚ùÑÔ∏è</div>
                <div class="absolute bottom-1/3 right-16 text-6xl animate-pulse filter drop-shadow-[0_0_15px_rgba(255,255,0,0.5)]">üïØÔ∏è</div>
                <div class="absolute bottom-20 right-8 text-6xl animate-bounce" style="animation-delay: 0.5s;">ü¶å</div>
            </div>

            <div class="w-full max-w-sm p-4 bg-black/80 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 relative z-10 mx-auto">
                <p class="text-xl text-yellow-400 mb-4 text-center font-bold">Press Play for a Special Message!</p>
                <div class="video-container mx-auto h-[60vh] rounded-xl overflow-hidden shadow-inner">
                    <video 
                        id="birthdayVideo" 
                        class="w-full h-full object-contain" 
                        controls 
                        preload="metadata" 
                        poster="https://placehold.co/600x400/1f2937/ffffff?text=Video+Message+Ready"
                        muted playsinline 
                        loop="false"
                    >
                        <source 
                            src="Santa.mp4" 
                            type="video/mp4"
                        >
                        Your browser does not support the video tag. Please ensure the video source is correctly set.
                    </video>
                    <p id="video-error-message" class="text-red-500 text-center mt-2 hidden">
                        *Note: Please replace the video source in the code with a valid, publicly accessible URL for your video to play.*
                    </p>
                </div>
            </div>
            
            <div id="video-next-door" class="absolute top-1/2 right-4 md:right-16 transform -translate-y-1/2 z-50 transition-all duration-1000 opacity-0 pointer-events-none group" onclick="goToStage(3)">
                <div class="relative w-36 h-56 cursor-pointer transform group-hover:scale-105 transition-transform duration-300">
                    <div class="absolute -top-3 left-[-10px] right-[-10px] h-6 bg-white rounded-full z-20 filter drop-shadow-md"></div>
                    
                    <div class="absolute inset-0 bg-[#5d4037] rounded-t-full shadow-2xl border-4 border-[#3e2723]"></div>
                    
                    <div class="absolute top-3 left-3 right-3 bottom-0 bg-[#b71c1c] rounded-t-full shadow-inner border border-[#7f0000] flex flex-col items-center justify-start pt-10">
                        <div class="w-20 h-10 border border-[#7f0000]/50 mb-2 rounded-t-lg bg-[#c62828]"></div>
                        <div class="w-20 h-24 border border-[#7f0000]/50 rounded-b-lg bg-[#c62828]"></div>
                        
                        <div class="absolute top-28 right-4 w-4 h-4 bg-yellow-400 rounded-full shadow-[1px_1px_2px_rgba(0,0,0,0.5)] group-hover:brightness-125 transition-all"></div>
                        
                        <div class="absolute top-8 text-4xl filter drop-shadow-lg">üéÑ</div>
                        
                         <div class="absolute bottom-4 bg-white/90 text-red-800 text-xs font-bold px-2 py-1 rounded shadow-lg animate-bounce">
                            Enter
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="stage-3" class="full-screen-stage festive-bg md:bg-transparent hidden p-4 overflow-hidden relative">
            
            <div class="absolute inset-0 pointer-events-none z-0">
                 <div class="stage-snow left-[5%]" style="animation-duration: 10s;">‚ùÑÔ∏è</div>
                 <div class="stage-snow left-[15%]" style="animation-duration: 14s; animation-delay: 2s;">‚ùÖ</div>
                 <div class="stage-snow left-[25%]" style="animation-duration: 11s; animation-delay: 4s;">‚ùÜ</div>
                 <div class="stage-snow left-[40%]" style="animation-duration: 16s; animation-delay: 1s;">‚ùÑÔ∏è</div>
                 <div class="stage-snow left-[55%]" style="animation-duration: 9s; animation-delay: 3s;">‚ùÖ</div>
                 <div class="stage-snow left-[70%]" style="animation-duration: 13s; animation-delay: 5s;">‚ùÜ</div>
                 <div class="stage-snow left-[85%]" style="animation-duration: 15s; animation-delay: 0s;">‚ùÑÔ∏è</div>
            </div>

            <div id="confetti-container" class="absolute inset-0 pointer-events-none z-0"></div>
            
            <div class="md:hidden w-full max-w-2xl bg-white/95 backdrop-blur-xl border-4 border-red-500 rounded-3xl shadow-[0_0_100px_rgba(255,215,0,0.3)] p-6 text-center relative z-10 transform transition-all duration-1000 scale-95 opacity-0 translate-y-10 flex flex-col items-center max-h-[85vh] overflow-y-auto" id="final-card-mobile">
                
                <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-red-600 via-green-500 to-red-600 font-pacifico mb-4 animate-pulse">
                    Ho Ho... Oops! üéÖ
                </h1>
                
                <div class="text-6xl mb-4 animate-shake filter drop-shadow-lg">üéÖüèª</div>
                
                <div class="bg-gray-100 text-gray-800 p-4 rounded-2xl relative mb-6 shadow-inner border border-gray-200">
                    <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[15px] border-l-transparent border-r-[15px] border-r-transparent border-b-[20px] border-b-gray-100"></div>
                    <p class="text-lg font-inter font-medium leading-relaxed italic">
                        "I checked my sleigh twice, and... oh deer. I seem to have left your main present at the North Pole! üì¶‚ùÑÔ∏è"
                    </p>
                </div>

                <p class="text-lg text-gray-800 font-inter font-bold leading-relaxed mb-6">
                    But don't worry! I've had a word with <span class="text-red-600 text-2xl font-extrabold underline decoration-wavy decoration-green-500">Sankho</span>...
                    <br><br>
                    <span class="text-indigo-900 font-medium">He promised to deliver it personally the moment he meets you! üéÅ‚ú®</span>
                </p>
                
                <button onclick="goToStage(0)" class="mt-2 px-8 py-3 bg-gradient-to-r from-red-600 to-green-600 text-white font-black text-xl rounded-full shadow-2xl hover:scale-110 transition-transform border-4 border-white">
                    I'll remind him! üòâ
                </button>
            </div>

            <div class="hidden md:flex absolute inset-0 overflow-hidden z-20 pointer-events-none">
                
                <div id="santa-layer" class="absolute top-[10%] left-[-20%] w-96 z-40 pointer-events-none transition-transform duration-1000 ease-linear">
                    <svg viewBox="0 0 500 200" width="100%" height="100%" fill="black" class="opacity-90 drop-shadow-2xl">
                         <path d="M400,160 Q420,130 450,150 T490,140 L480,160 H420 Z" fill="#b91c1c"/> 
                         <path d="M400,160 Q410,180 450,175 L490,170" stroke="#fcd34d" stroke-width="4" fill="none"/> 
                         <rect x="430" y="140" width="30" height="20" fill="#1f2937" rx="2" /> 
                         <circle cx="460" cy="145" r="8" fill="#fca5a5"/> 
                         <path d="M455,145 Q460,155 465,145" stroke="white" stroke-width="2" fill="white"/> 
                         <path d="M350,150 Q360,140 370,150 L370,170 L350,170 Z" fill="#a16207"/> 
                         <path d="M300,145 Q310,135 320,145 L320,165 L300,165 Z" fill="#a16207"/> 
                         <line x1="400" y1="155" x2="370" y2="155" stroke="#fcd34d" stroke-width="1"/> 
                         <line x1="350" y1="155" x2="320" y2="155" stroke="#fcd34d" stroke-width="1"/> 
                    </svg>
                </div>

                <div id="dropped-letter" class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[50] cursor-pointer pointer-events-auto group" onclick="openFinalLetter()">
                    <div class="relative w-40 h-28 bg-[#fefce8] rounded-md shadow-2xl flex items-center justify-center border-4 border-[#b45309] animate-float">
                        <div class="absolute inset-0 flex items-center justify-center flex-col">
                            <span class="text-3xl">üéÖ</span>
                            <span class="text-[#b45309] font-bold font-pacifico mt-1 text-sm">Open Me!</span>
                        </div>
                        <div class="absolute -bottom-3 right-[-10px] w-8 h-8 bg-red-700 rounded-full border-2 border-red-900 shadow-md flex items-center justify-center text-white text-[8px] font-bold">S.C.</div>
                    </div>
                    <div class="absolute -top-12 left-1/2 -translate-x-1/2 bg-white/90 px-3 py-1 rounded-full text-xs font-bold text-red-600 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        A Special Delivery!
                    </div>
                </div>

                <div id="gift-grid-container" class="hidden absolute inset-0 z-[60] flex flex-col items-center justify-center pointer-events-auto transition-opacity duration-500 opacity-0">
                    
                    <h2 class="text-3xl md:text-5xl font-pacifico text-white mb-4 md:mb-8 animate-pulse text-center drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">
                        Pick a Surprise! üéÅ
                    </h2>

                    <div class="flex flex-wrap justify-center items-center gap-4 md:gap-6 max-w-5xl px-4 max-h-[70vh] overflow-y-auto">
                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üëú', 'A Chic Purse!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-red-600 rounded-lg shadow-lg border-b-4 border-red-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üëú</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üåπ', 'A Lovely Rose!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-green-600 rounded-lg shadow-lg border-b-4 border-green-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üåπ</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üç´', 'Sweet Chocolate!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-blue-600 rounded-lg shadow-lg border-b-4 border-blue-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üç´</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üß∏', 'Cuddly Teddy!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-purple-600 rounded-lg shadow-lg border-b-4 border-purple-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üß∏</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üëó', 'A Stunning Dress!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-pink-600 rounded-lg shadow-lg border-b-4 border-pink-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üëó</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üë†', 'Fancy Heels!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-orange-600 rounded-lg shadow-lg border-b-4 border-orange-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üë†</span>
                                </div>
                            </div>
                        </div>

                        <div class="group relative w-24 h-24 md:w-32 md:h-32 cursor-pointer perspective-1000" onclick="popGift(this, 'üëë', 'Shiny Jewelry!')">
                            <div class="gift-box-inner relative w-full h-full transform-style-3d transition-transform duration-500 group-hover:scale-105">
                                <div class="absolute inset-0 bg-teal-600 rounded-lg shadow-lg border-b-4 border-teal-800 flex items-center justify-center z-20 gift-lid">
                                    <span class="text-4xl">üéÅ</span>
                                </div>
                                <div class="absolute inset-0 bg-white rounded-lg flex items-center justify-center z-10 opacity-0 gift-content transition-opacity duration-300">
                                    <span class="text-5xl animate-bounce">üëë</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <p id="gift-message" class="mt-4 md:mt-8 text-xl md:text-2xl font-bold text-white font-inter opacity-0 transition-opacity duration-500 min-h-[2rem] drop-shadow-md bg-black/30 px-4 py-2 rounded-full"></p>

                    <button onclick="closeGiftGrid()" class="mt-4 md:mt-8 px-6 py-2 bg-red-600 hover:bg-red-500 border-2 border-white text-white rounded-full font-bold transition-colors pointer-events-auto shadow-lg">
                        Close
                    </button>
                </div>

                <div id="final-letter-content" class="hidden absolute inset-0 z-[70] flex items-center justify-center pointer-events-none p-4"> 
                    <div class="relative letter-texture text-gray-900 p-8 md:p-12 rounded-sm shadow-[0_0_60px_rgba(255,215,0,0.2)] max-w-2xl w-full mx-auto transform scale-100 transition-transform duration-500 max-h-[90vh] overflow-y-auto border-[16px] border-double border-[#854d0e] pointer-events-auto bg-[#fffbeb]">
                        
                        <div class="absolute top-2 left-2 w-20 h-20 border-t-[1px] border-l-[1px] border-[#854d0e] opacity-40"></div>
                        <div class="absolute top-2 right-2 w-20 h-20 border-t-[1px] border-r-[1px] border-[#854d0e] opacity-40"></div>
                        <div class="absolute bottom-2 left-2 w-20 h-20 border-b-[1px] border-l-[1px] border-[#854d0e] opacity-40"></div>
                        <div class="absolute bottom-2 right-2 w-20 h-20 border-b-[1px] border-r-[1px] border-[#854d0e] opacity-40"></div>

                        <div class="absolute -top-6 -right-6 w-20 h-20 bg-red-800 rounded-full flex items-center justify-center shadow-lg border-4 border-red-900 z-50 transform rotate-12">
                            <span class="text-white font-pacifico text-sm text-center leading-tight opacity-80 border-2 border-red-900 rounded-full p-1 w-14 h-14 flex items-center justify-center">North<br>Pole</span>
                        </div>

                        <button onclick="closeFinalLetter()" class="absolute top-4 right-4 text-[#854d0e] hover:text-red-700 transition-colors pointer-events-auto z-40">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                        
                        <div class="flex flex-col items-center text-center space-y-6 relative z-10">
                            <div class="w-20 h-20 bg-red-700 rounded-full flex items-center justify-center text-4xl shadow-md border-4 border-[#fcd34d]">üéÖ</div>
                            
                            <h2 class="text-4xl md:text-5xl font-pacifico text-[#991b1b] drop-shadow-sm pb-2 border-b-2 border-[#b45309]/20 w-full">From Santa's Desk</h2>
                            
                            <p class="text-xl md:text-2xl font-inter leading-relaxed text-gray-800 font-medium italic">
                                "Dearest Juhi,<br><br>
                                I am writing to apologize... oh deer! ü¶å<br>
                                I checked my sleigh twice, but it seems I forgot your special 21st birthday gift back at the North Pole! üì¶‚ùÑÔ∏è<br><br>
                                But don't worry! I've entrusted <span class="text-red-700 font-bold border-b-2 border-red-300">Sankho</span> with this important mission.<br>
                                He has promised to deliver it to you personally! üéÅ‚ú®<br><br>
                                Wishing you a magical 21st Birthday!"
                            </p>

                            <div class="pt-6 w-full flex flex-col md:flex-row justify-between items-center gap-4">
                                <button onclick="transitionToGifts()" class="px-8 py-3 bg-gradient-to-r from-red-700 to-red-600 hover:from-red-600 hover:to-red-500 text-white font-bold text-lg rounded-full shadow-[0_4px_14px_0_rgba(220,38,38,0.39)] transition-all transform hover:scale-105 pointer-events-auto border-2 border-[#fca5a5]">
                                    Open Your Gifts üéÅ
                                </button>
                                <div class="text-center md:text-right">
                                    <p class="font-pacifico text-3xl text-[#991b1b] transform -rotate-3">Santa Claus</p>
                                    <p class="text-xs text-[#854d0e] font-inter uppercase tracking-widest mt-1 font-bold">Official North Pole Mail</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const stages = ['#stage-0', '#stage-1', '#stage-2', '#stage-3'];
        const moonContainer = document.getElementById('moon-wrapper');
        const moonSlider = document.getElementById('moon-slider');
        const panelLeft = document.getElementById('moon-panel-left');
        const panelRight = document.getElementById('moon-panel-right');
        
        const moonNextBtn = document.getElementById('moon-next-btn');
        const moonCaption = document.getElementById('moon-caption');
        const moonInstruction = document.getElementById('moon-instruction');
        const pauseToggleBtn = document.getElementById('pause-toggle-btn');
        const pauseText = document.getElementById('pause-text');
        const video = document.getElementById('birthdayVideo');
        const videoNextDoor = document.getElementById('video-next-door'); 
        const videoErrorMessage = document.getElementById('video-error-message');
        const moonTracker = document.getElementById('moon-tracker');
        
        const finalCardMobile = document.getElementById('final-card-mobile');
        const confettiContainer = document.getElementById('confetti-container');
        
        const santaLayer = document.getElementById('santa-layer');
        const droppedLetter = document.getElementById('dropped-letter');
        const giftGridContainer = document.getElementById('gift-grid-container');
        const giftMessage = document.getElementById('gift-message');
        
        let colorIndex = 0;
        let colorTimeout = null; 
        let isPaused = false;
        
        const transitionDelay = 4000; 

        const colors = [
            { color: '#00BFFF', shadow: 'rgba(0, 191, 255, 0.8)' }, 
            { color: '#8A2BE2', shadow: 'rgba(138, 43, 226, 0.8)' }, 
            { color: '#FF4500', shadow: 'rgba(255, 69, 0, 0.8)' },    
            { color: '#FFD700', shadow: 'rgba(255, 215, 0, 0.8)' },  
            { color: '#f97316', shadow: 'rgba(249, 115, 22, 0.8)' },  
            { color: '#FF69B4', shadow: 'rgba(255, 105, 180, 0.8)' }, 
            { color: '#ffffff', shadow: 'rgba(255, 255, 255, 1)' }    
        ];

        const moonMessages = [
            "The ocean's breath, a crystal blue,\nMy favorite truth, forever true.\nEach passing thought, a lovely breeze,\nYou bring my searching soul ease.", 
            "A violet hue, profound and deep,\nThe secret wonders that you keep.\nYour graceful mind, a calming sight,\nYou fill the universe with light.", 
            "Like crimson dawn, your spirit burns,\nFor all the world, the heart yearns.\nKindness shines, a gentle fire,\nA passionate beauty to admire.", 
            "A golden aura lights the way,\nJust like your smile at break of day.\nYour eyes hold stars, a vibrant grace,\nThe softest glow upon your face.", 
            "The warmth of sunset, bold and bright,\nA guiding star through endless night.\nYour energy flows, a fierce embrace,\nA loving warmth time can't erase.", 
            "A rosy blush, so sweet and fair,\nThe perfect gem beyond compare.\nMy final wish, I send to you,\nMy heart's devotion, strong and new.", 
            "The moon awaits your touch...\nPure and bright, the journey ends.\nA white light shines, where love begins." 
        ];
        
        function initMoonTracker() {
            moonTracker.innerHTML = '';
            colors.forEach((c, idx) => {
                const dot = document.createElement('div');
                dot.className = 'moon-tracker-dot';
                dot.style.color = c.color; 
                moonTracker.appendChild(dot);
            });
        }
        
        function updateTrackerDot(idx) {
            const dots = moonTracker.children;
            for(let i=0; i<dots.length; i++) {
                if (i <= idx) {
                    dots[i].style.backgroundColor = colors[i].color;
                    dots[i].classList.add('active');
                } else {
                    dots[i].style.backgroundColor = 'rgba(255,255,255,0.2)';
                    dots[i].classList.remove('active');
                }
            }
        }

        function getMoonGradient(baseColor) {
            return `radial-gradient(circle at 30% 30%, ${baseColor} 0%, ${baseColor} 60%, #000000 150%)`;
        }

        function setPanelColor(panel, index) {
            if(!panel || index >= colors.length) return;
            const currentColors = colors[index];
            panel.style.background = getMoonGradient(currentColors.color);
        }

        function initializeMoon() {
            setPanelColor(panelLeft, 0); 
            setPanelColor(panelRight, 1); 
            
            moonContainer.style.boxShadow = `inset -20px -20px 60px rgba(0,0,0,0.8), inset 5px 5px 20px rgba(255,255,255,0.4), 0 0 60px ${colors[0].shadow}`;
            
            moonSlider.classList.remove('moon-spinning');
            moonSlider.style.transform = 'translateX(0%)';
            
            updateTrackerDot(0);
        }
        
        function changeMoonColor() {
            if (isPaused) return;

            let nextIndex = colorIndex + 1;
            
            if (nextIndex < colors.length) {
                setPanelColor(panelRight, nextIndex);
                
                moonSlider.classList.add('moon-spinning');
                
                setTimeout(() => {
                    moonCaption.textContent = moonMessages[nextIndex];
                    updateTrackerDot(nextIndex);
                    moonContainer.style.boxShadow = `inset -20px -20px 60px rgba(0,0,0,0.8), inset 5px 5px 20px rgba(255,255,255,0.4), 0 0 60px ${colors[nextIndex].shadow}`;
                }, 1000); 

                setTimeout(() => {
                    
                    moonSlider.classList.remove('moon-spinning');
                    
                    setPanelColor(panelLeft, nextIndex);
                    
                    if (nextIndex + 1 < colors.length) {
                        setPanelColor(panelRight, nextIndex + 1);
                    }
                    
                    colorIndex = nextIndex;

                    if (colorIndex < colors.length - 1) {
                        colorTimeout = setTimeout(changeMoonColor, 1000); 
                    } else {
                        finishSequence();
                    }
                }, 4000); 
                
            } else {
                finishSequence();
            }
        }
        
        function finishSequence() {
            moonContainer.classList.add('magical'); 
            
            moonInstruction.className = "text-xl font-black text-yellow-300 bg-black/50 px-8 py-3 rounded-full border-2 border-yellow-400 shadow-[0_0_20px_rgba(253,224,71,0.5)] backdrop-blur-md transition-all duration-500 scale-110 pointer-events-none select-none";
            moonInstruction.classList.remove('opacity-0'); 
            moonInstruction.textContent = "Portal Ready!";
            
            pauseToggleBtn.classList.add('opacity-0', 'hidden'); 
            moonContainer.removeEventListener('click', startMoonSequence); 
            moonNextBtn.classList.remove('opacity-0', 'cursor-default');
            moonNextBtn.classList.add('opacity-100');
            moonNextBtn.disabled = false;
        }

        function startMoonSequence() {
            moonContainer.removeEventListener('click', startMoonSequence); 
            
            moonInstruction.classList.add('opacity-0');
            
            moonCaption.classList.remove('opacity-0');
            
            pauseToggleBtn.classList.remove('hidden');
            setTimeout(() => pauseToggleBtn.classList.add('opacity-100'), 50);

            colorTimeout = setTimeout(changeMoonColor, 1000); 
        }

        function togglePause() {
            if (isPaused) {
                resumeMoonSequence(true);
            } else {
                pauseMoonSequence(true);
            }
        }
        
        function pauseMoonSequence(fromButton = false) {
            if (colorTimeout) {
                clearTimeout(colorTimeout);
                colorTimeout = null;
            }
            isPaused = true;
            moonInstruction.classList.remove('opacity-0');
            moonInstruction.className = "text-xl font-black text-yellow-300 bg-black/50 px-8 py-3 rounded-full border-2 border-yellow-400 shadow-[0_0_20px_rgba(253,224,71,0.5)] backdrop-blur-md transition-all duration-500 scale-110 pointer-events-none select-none";
            moonInstruction.textContent = "Paused.";
            
            moonSlider.style.animationPlayState = 'paused';
            
            if (fromButton) {
                pauseText.textContent = "Resume";
            }
        }

        function resumeMoonSequence(fromButton = false) {
            if (colorIndex >= colors.length - 1) return; 
            
            moonSlider.style.animationPlayState = 'running';
            moonInstruction.classList.add('opacity-0');
            
            if (!colorTimeout && !moonSlider.classList.contains('moon-spinning')) {
                 colorTimeout = setTimeout(changeMoonColor, 1000); 
            }
            
            isPaused = false;
            
            if (fromButton) {
                pauseText.textContent = "Pause";
            }
        }
        
        moonContainer.addEventListener('mousedown', () => pauseMoonSequence(false));
        moonContainer.addEventListener('mouseup', () => resumeMoonSequence(false));
        moonContainer.addEventListener('touchstart', () => pauseMoonSequence(false));
        moonContainer.addEventListener('touchend', () => resumeMoonSequence(false));

        function createConfetti() {
            const colors = ['#fde68a', '#fca5a5', '#86efac', '#93c5fd', '#d8b4fe', '#fcd34d'];
            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDuration = (Math.random() * 3 + 2) + 's';
                piece.style.animationDelay = (Math.random() * 2) + 's';
                confettiContainer.appendChild(piece);
            }
        }

        function triggerSantaAnimation() {
            santaLayer.classList.remove('animate-santa-fly-by');
            void santaLayer.offsetWidth; 
            santaLayer.classList.add('animate-santa-fly-by');
            
            droppedLetter.classList.add('hidden');
            droppedLetter.classList.remove('animate-letter-drop');
            
            setTimeout(() => {
                droppedLetter.classList.remove('hidden');
                droppedLetter.classList.add('animate-letter-drop');
            }, 3000);
        }

        function revealGiftGrid() {
            giftGridContainer.classList.remove('hidden');
            giftGridContainer.classList.add('pointer-events-auto');
            setTimeout(() => {
                giftGridContainer.classList.remove('opacity-0');
            }, 50);
            droppedLetter.classList.add('hidden');
        }

        function closeGiftGrid() {
            giftGridContainer.classList.add('opacity-0');
            giftGridContainer.classList.remove('pointer-events-auto');
            setTimeout(() => {
                giftGridContainer.classList.add('hidden');
            }, 500);
            
            const boxes = document.querySelectorAll('.gift-box-inner');
            boxes.forEach(box => {
                box.parentElement.classList.remove('box-open');
                const lid = box.querySelector('.gift-lid');
                const content = box.querySelector('.gift-content');
                
                lid.style.transform = '';
                lid.style.opacity = '1';
                content.style.opacity = '0';
                content.style.transform = 'scale(0)';
            });
            giftMessage.style.opacity = '0';
            giftMessage.textContent = '';
        }

        function openFinalLetter() {
            const letterContent = document.getElementById('final-letter-content');
            const droppedLetter = document.getElementById('dropped-letter');
            
            droppedLetter.classList.add('hidden');

            if(letterContent) {
                letterContent.classList.remove('hidden');
                letterContent.classList.remove('pointer-events-none');
                letterContent.classList.add('pointer-events-auto');
                
                setTimeout(() => {
                    letterContent.classList.remove('opacity-0');
                    letterContent.querySelector('div').classList.remove('scale-90');
                    letterContent.querySelector('div').classList.add('scale-100');
                }, 50);
            }
        }

        function closeFinalLetter() {
            const letterContent = document.getElementById('final-letter-content');
            const droppedLetter = document.getElementById('dropped-letter');
            
            if(letterContent) {
                letterContent.classList.add('opacity-0');
                letterContent.querySelector('div').classList.add('scale-90');
                letterContent.querySelector('div').classList.remove('scale-100');
                
                setTimeout(() => {
                    letterContent.classList.add('hidden');
                    letterContent.classList.add('pointer-events-none');
                    letterContent.classList.remove('pointer-events-auto');
                    droppedLetter.classList.remove('hidden');
                }, 500);
            }
        }

        function transitionToGifts() {
            const letterContent = document.getElementById('final-letter-content');
            
            if(letterContent) {
                letterContent.classList.add('opacity-0');
                letterContent.querySelector('div').classList.add('scale-90');
                letterContent.querySelector('div').classList.remove('scale-100');
                
                setTimeout(() => {
                    letterContent.classList.add('hidden');
                    letterContent.classList.add('pointer-events-none');
                    letterContent.classList.remove('pointer-events-auto');
                    revealGiftGrid();
                }, 500);
            }
        }

        function popGift(element, icon, message) {
            if(element.classList.contains('box-open')) return;
            
            element.classList.add('box-open');
            const lid = element.querySelector('.gift-lid');
            const content = element.querySelector('.gift-content');
            
            lid.style.transform = 'translateY(-60px) rotate(-20deg)';
            lid.style.opacity = '0';
            
            content.style.opacity = '1';
            content.style.transform = 'scale(1)';
            
            giftMessage.textContent = message;
            giftMessage.style.opacity = '1';
        }

        function goToStage(stageIndex) {
            stages.forEach(selector => {
                document.querySelector(selector).classList.add('hidden');
            });
            document.querySelector(stages[stageIndex]).classList.remove('hidden');
            document.querySelector(stages[stageIndex]).classList.add('flex'); 
            
            video.pause();
            video.currentTime = 0;
            videoNextDoor.classList.add('opacity-0', 'pointer-events-none');
            videoErrorMessage.classList.add('hidden');

            const staticMoon = document.getElementById('static-moon');
            if (stageIndex === 1) {
                staticMoon.classList.add('opacity-0');
            } else {
                staticMoon.classList.remove('opacity-0');
            }

            const desktopBg = document.getElementById('desktop-bg-scene');
            if (stageIndex === 3) {
                desktopBg.classList.remove('desktop-scene-bg');
                desktopBg.classList.add('bg-finale-desktop');
            } else {
                desktopBg.classList.add('desktop-scene-bg');
                desktopBg.classList.remove('bg-finale-desktop');
            }

            if (stageIndex === 1) {
                initMoonTracker();
                colorIndex = 0;
                isPaused = false;
                
                initializeMoon();
                
                pauseToggleBtn.classList.add('opacity-0', 'hidden'); 

                moonContainer.addEventListener('click', startMoonSequence, { once: true });
                if (colorTimeout) clearTimeout(colorTimeout); 

                moonInstruction.className = "text-lg font-bold text-indigo-900 bg-white/90 px-8 py-3 rounded-full shadow-[0_0_15px_rgba(255,255,255,0.6)] backdrop-blur-md transition-all duration-500 hover:scale-105 pointer-events-none select-none animate-bounce border-2 border-white";
                moonInstruction.classList.remove('opacity-0');
                moonInstruction.textContent = "Tap Me!";
                
                moonCaption.textContent = moonMessages[0];
                moonCaption.classList.add('opacity-0');
                moonNextBtn.classList.add('opacity-0', 'cursor-default');
                moonNextBtn.disabled = true;
                moonContainer.classList.remove('magical'); 
                pauseText.textContent = "Pause";
            } else if (stageIndex === 2) {
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        setTimeout(() => {
                            videoNextDoor.classList.remove('opacity-0', 'pointer-events-none');
                        }, 3000); 
                    }).catch(error => {
                        console.log("Autoplay prevented:", error);
                        videoNextDoor.classList.remove('opacity-0', 'pointer-events-none');
                        videoErrorMessage.classList.remove('hidden');
                    });
                }
            } else if (stageIndex === 3) {
                confettiContainer.innerHTML = ''; 
                createConfetti();
                
                if(finalCardMobile) {
                    setTimeout(() => {
                        finalCardMobile.classList.remove('scale-95', 'opacity-0', 'translate-y-10');
                        finalCardMobile.classList.add('scale-100', 'opacity-100', 'translate-y-0');
                    }, 100);
                }
                
                if(window.innerWidth >= 768) {
                    triggerSantaAnimation();
                }
            }
        }

        video.onended = function() {
        };

        const mainContent = document.getElementById('mainContent');
        const topNav = document.getElementById('topNav');
        const bottomNav = document.getElementById('bottomNav');
        const leftNav = document.getElementById('leftNav');
        const rightNav = document.getElementById('rightNav');
        const desktopNav = document.getElementById('desktopNav');
        const navToggle = document.getElementById('navToggle');
        const navToggleIcon = document.getElementById('navToggleIcon');
        const navToggleX = document.getElementById('navToggleX');

        let areNavsOpen = false;
        const isDesktop = () => window.innerWidth >= 768;

        function openAllNavs() {
            if (isDesktop()) {
                desktopNav.classList.remove('-translate-x-full');
            } else {
                topNav.classList.remove('-translate-y-full');
                bottomNav.classList.remove('translate-y-full');
                leftNav.classList.remove('-translate-x-full');
                rightNav.classList.remove('translate-x-full');
                mainContent.classList.add('pt-16', 'pb-16', 'pl-20', 'pr-20');
                mainContent.classList.remove('pt-16');
            }
            navToggleIcon.classList.add('hidden');
            navToggleX.classList.remove('hidden');
            areNavsOpen = true;
        }

        function closeAllNavs() {
            if (isDesktop()) {
                desktopNav.classList.add('-translate-x-full');
            } else {
                topNav.classList.add('-translate-y-full');
                bottomNav.classList.add('translate-y-full');
                leftNav.classList.add('-translate-x-full');
                rightNav.classList.add('translate-x-full');
                mainContent.classList.remove('pt-16', 'pb-16', 'pl-20', 'pr-20');
                mainContent.classList.add('pt-16');
            }
            navToggleIcon.classList.remove('hidden');
            navToggleX.classList.add('hidden');
            areNavsOpen = false;
        }

        function toggleAllNavs() {
            if (areNavsOpen) {
                closeAllNavs();
            } else {
                openAllNavs();
            }
        }

        function handleNavClick(linkName) {
            console.log(`Navigation link clicked: ${linkName}. Closing menus.`);
            closeAllNavs();
            return false;
        }

        navToggle.addEventListener('click', (e) => {
            e.stopPropagation(); 
            toggleAllNavs();
        });

        mainContent.addEventListener('click', () => {
            if (areNavsOpen) {
                closeAllNavs();
            }
        });

        window.addEventListener('resize', () => {
            if(areNavsOpen) closeAllNavs();
        });
        
        document.addEventListener('mousemove', function(e) {
            if (window.innerWidth < 768) return;
            const snowflake = document.createElement('div');
            snowflake.classList.add('snow-particle');
            const size = Math.random() * 8 + 4; 
            snowflake.style.width = `${size}px`;
            snowflake.style.height = `${size}px`;
            snowflake.style.left = `${e.pageX}px`;
            snowflake.style.top = `${e.pageY}px`;
            document.body.appendChild(snowflake);
            setTimeout(() => {
                snowflake.remove();
            }, 1000);
        });
        
        function unwrapGift(giftElement) {
            if(giftElement.classList.contains('opened')) return;
            giftElement.classList.add('opened');
            const wrapper = giftElement.querySelector('.gift-wrapper');
            const content = giftElement.querySelector('.gift-content');
            wrapper.classList.add('scale-0', 'opacity-0');
            content.classList.remove('scale-0', 'opacity-0');
            content.classList.add('scale-100', 'opacity-100');
        }

        document.addEventListener('DOMContentLoaded', () => {
            goToStage(0);
        });
    </script>
</body>
</html>